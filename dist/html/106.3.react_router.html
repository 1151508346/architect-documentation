<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>架构师成长计划</title><link rel="stylesheet" type="text/css" href="../static/css/main.css"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"><style>.page-toc>ul .red{background:#f3f3f3;z-index:1;border-left:3px solid #009a61;-webkit-transition:all .2s ease;transition:all .2s ease;color:#000}</style></head><body><div class="nav"><div class="logo">架构师成长计划</div><ul><li><a href="../index.html">0.api</a></li><li><a href="../html/0.Async.html">0.Async</a></li><li><a href="../html/0.module.html">0.module</a></li><li><a href="../html/1.ES2015.html">1.ES2015</a></li><li><a href="../html/2.Promise.html">2.Promise</a></li><li><a href="../html/3.Node.html">3.Node</a></li><li><a href="../html/4.NodeInstall.html">4.NodeInstall</a></li><li><a href="../html/5.REPL.html">5.REPL</a></li><li><a href="../html/6.NodeCore.html">6.NodeCore</a></li><li><a href="../html/7.module&NPM.html">7.module&NPM</a></li><li><a href="../html/8.Encoding.html">8.Encoding</a></li><li><a href="../html/9.Buffer.html">9.Buffer</a></li><li><a href="../html/10.fs.html">10.fs</a></li><li><a href="../html/11.Stream-1.html">11.Stream-1</a></li><li><a href="../html/11.Stream-2.html">11.Stream-2</a></li><li><a href="../html/11.Stream-3.html">11.Stream-3</a></li><li><a href="../html/11.Stream-4.html">11.Stream-4</a></li><li><a href="../html/12-Network-2.html">12-Network-2</a></li><li><a href="../html/12.NetWork-3.html">12.NetWork-3</a></li><li><a href="../html/12.Network-1.html">12.Network-1</a></li><li><a href="../html/13.tcp.html">13.tcp</a></li><li><a href="../html/14.http-1.html">14.http-1</a></li><li><a href="../html/14.http-2.html">14.http-2</a></li><li><a href="../html/15.compress.html">15.compress</a></li><li><a href="../html/16.crypto.html">16.crypto</a></li><li><a href="../html/17.process.html">17.process</a></li><li><a href="../html/18.yargs.html">18.yargs</a></li><li><a href="../html/19.cache.html">19.cache</a></li><li><a href="../html/20.action.html">20.action</a></li><li><a href="../html/21.https.html">21.https</a></li><li><a href="../html/22.cookie.html">22.cookie</a></li><li><a href="../html/23.session.html">23.session</a></li><li><a href="../html/24.express-1.html">24.express-1</a></li><li><a href="../html/24.express-2.html">24.express-2</a></li><li><a href="../html/24.express-3.html">24.express-3</a></li><li><a href="../html/24.express-4.html">24.express-4</a></li><li><a href="../html/25.koa-1.html">25.koa-1</a></li><li><a href="../html/26.webpack-1-basic.html">26.webpack-1-basic</a></li><li><a href="../html/26.webpack-2-optimize.html">26.webpack-2-optimize</a></li><li><a href="../html/26.webpack-3-file.html">26.webpack-3-file</a></li><li><a href="../html/26.webpack-4.tapable.html">26.webpack-4.tapable</a></li><li><a href="../html/26.webpack-5-AST.html">26.webpack-5-AST</a></li><li><a href="../html/26.webpack-6-sources.html">26.webpack-6-sources</a></li><li><a href="../html/26.webpack-7-loader.html">26.webpack-7-loader</a></li><li><a href="../html/26.webpack-8-plugin.html">26.webpack-8-plugin</a></li><li><a href="../html/26.webpack-9-hand.html">26.webpack-9-hand</a></li><li><a href="../html/26.webpack-10-prepare.html">26.webpack-10-prepare</a></li><li><a href="../html/28.redux.html">28.redux</a></li><li><a href="../html/28.redux-jwt-back.html">28.redux-jwt-back</a></li><li><a href="../html/28.redux-jwt-front.html">28.redux-jwt-front</a></li><li><a href="../html/29.mongodb-1.html">29.mongodb-1</a></li><li><a href="../html/29.mongodb-2.html">29.mongodb-2</a></li><li><a href="../html/29.mongodb-3.html">29.mongodb-3</a></li><li><a href="../html/29.mongodb-4.html">29.mongodb-4</a></li><li><a href="../html/29.mongodb-5.html">29.mongodb-5</a></li><li><a href="../html/29.mongodb-6.html">29.mongodb-6</a></li><li><a href="../html/30.cms-1-mysql.html">30.cms-1-mysql</a></li><li><a href="../html/30.cms-2-mysql.html">30.cms-2-mysql</a></li><li><a href="../html/30.cms-3-mysql.html">30.cms-3-mysql</a></li><li><a href="../html/30.cms-4-nunjucks.html">30.cms-4-nunjucks</a></li><li><a href="../html/30.cms-5-mock.html">30.cms-5-mock</a></li><li><a href="../html/30.cms-6-egg.html">30.cms-6-egg</a></li><li><a href="../html/30.cms-7-api.html">30.cms-7-api</a></li><li><a href="../html/30.cms-8-roadhog.html">30.cms-8-roadhog</a></li><li><a href="../html/30.cms-9-yaml.html">30.cms-9-yaml</a></li><li><a href="../html/30.cms-10-umi.html">30.cms-10-umi</a></li><li><a href="../html/30.cms-12-dva.html">30.cms-12-dva</a></li><li><a href="../html/30.cms-13-dva-ant.html">30.cms-13-dva-ant</a></li><li><a href="../html/30.cms-14-front.html">30.cms-14-front</a></li><li><a href="../html/30.cms-15-deploy.html">30.cms-15-deploy</a></li><li><a href="../html/31.dva.html">31.dva</a></li><li><a href="../html/31.cms-13-dva-antdesign.html">31.cms-13-dva-antdesign</a></li><li><a href="../html/33.redis.html">33.redis</a></li><li><a href="../html/34.unittest.html">34.unittest</a></li><li><a href="../html/35.jwt.html">35.jwt</a></li><li><a href="../html/36.websocket-1.html">36.websocket-1</a></li><li><a href="../html/36.websocket-2.html">36.websocket-2</a></li><li><a href="../html/38.chat-api-1.html">38.chat-api-1</a></li><li><a href="../html/38.chat-api-2.html">38.chat-api-2</a></li><li><a href="../html/38.chat-3.html">38.chat-3</a></li><li><a href="../html/38.chat-api-3.html">38.chat-api-3</a></li><li><a href="../html/38.chat.html">38.chat</a></li><li><a href="../html/38.chat2.html">38.chat2</a></li><li><a href="../html/38.chat2.html">38.chat2</a></li><li><a href="../html/39.crawl-0.html">39.crawl-0</a></li><li><a href="../html/39.crawl-1.html">39.crawl-1</a></li><li><a href="../html/39.crawl-2.html">39.crawl-2</a></li><li><a href="../html/40.deploy.html">40.deploy</a></li><li><a href="../html/41.safe.html">41.safe</a></li><li><a href="../html/42.test.html">42.test</a></li><li><a href="../html/43.nginx.html">43.nginx</a></li><li><a href="../html/44.enzyme.html">44.enzyme</a></li><li><a href="../html/45.docker.html">45.docker</a></li><li><a href="../html/46.elastic.html">46.elastic</a></li><li><a href="../html/47.oauth.html">47.oauth</a></li><li><a href="../html/48.wxpay.html">48.wxpay</a></li><li><a href="../html/index.html">index</a></li><li><a href="../html/52.UML.html">52.UML</a></li><li><a href="../html/53.design.html">53.design</a></li><li><a href="../html/index.html">index</a></li><li><a href="../html/54.linux.html">54.linux</a></li><li><a href="../html/57.ts.html">57.ts</a></li><li><a href="../html/56.react-ssr.html">56.react-ssr</a></li><li><a href="../html/58.ts_react.html">58.ts_react</a></li><li><a href="../html/59.ketang.html">59.ketang</a></li><li><a href="../html/59.ketang2.html">59.ketang2</a></li><li><a href="../html/61.1.devops-linux.html">61.1.devops-linux</a></li><li><a href="../html/61.2.devops-vi.html">61.2.devops-vi</a></li><li><a href="../html/61.3.devops-user.html">61.3.devops-user</a></li><li><a href="../html/61.4.devops-auth.html">61.4.devops-auth</a></li><li><a href="../html/61.5.devops-shell.html">61.5.devops-shell</a></li><li><a href="../html/61.6.devops-install.html">61.6.devops-install</a></li><li><a href="../html/61.7.devops-system.html">61.7.devops-system</a></li><li><a href="../html/61.8.devops-service.html">61.8.devops-service</a></li><li><a href="../html/61.9.devops-network.html">61.9.devops-network</a></li><li><a href="../html/61.10.devops-nginx.html">61.10.devops-nginx</a></li><li><a href="../html/61.11.devops-docker.html">61.11.devops-docker</a></li><li><a href="../html/61.12.devops-jekins.html">61.12.devops-jekins</a></li><li><a href="../html/61.13.devops-groovy.html">61.13.devops-groovy</a></li><li><a href="../html/61.14.devops-php.html">61.14.devops-php</a></li><li><a href="../html/61.15.devops-java.html">61.15.devops-java</a></li><li><a href="../html/61.16.devops-node.html">61.16.devops-node</a></li><li><a href="../html/61.17.devops-k8s.html">61.17.devops-k8s</a></li><li><a href="../html/62.1.react-basic.html">62.1.react-basic</a></li><li><a href="../html/62.2.react-state.html">62.2.react-state</a></li><li><a href="../html/62.3.react-high.html">62.3.react-high</a></li><li><a href="../html/62.4.react-optimize.html">62.4.react-optimize</a></li><li><a href="../html/62.5.react-hooks.html">62.5.react-hooks</a></li><li><a href="../html/62.6.react-immutable.html">62.6.react-immutable</a></li><li><a href="../html/62.7.react-mobx.html">62.7.react-mobx</a></li><li><a href="../html/62.8.react-source.html">62.8.react-source</a></li><li><a href="../html/63.1.redux.html">63.1.redux</a></li><li><a href="../html/63.2.redux-middleware.html">63.2.redux-middleware</a></li><li><a href="../html/63.3.redux-hooks.html">63.3.redux-hooks</a></li><li><a href="../html/63.4.redux-saga.html">63.4.redux-saga</a></li><li><a href="../html/63.5.redux-saga-hand.html">63.5.redux-saga-hand</a></li><li><a href="../html/64.1.router.html">64.1.router</a></li><li><a href="../html/64.2.router-connected.html">64.2.router-connected</a></li><li><a href="../html/65.1.typescript.html">65.1.typescript</a></li><li><a href="../html/65.2.typescript.html">65.2.typescript</a></li><li><a href="../html/65.3.typescript.html">65.3.typescript</a></li><li><a href="../html/65.4.antd.html">65.4.antd</a></li><li><a href="../html/65.4.definition.html">65.4.definition</a></li><li><a href="../html/66-1.vue-base.html">66-1.vue-base</a></li><li><a href="../html/66-2.vue-component.html">66-2.vue-component</a></li><li><a href="../html/66-3.vue-cli3.0.html">66-3.vue-cli3.0</a></li><li><a href="../html/66-4.$message组件.html">66-4.$message组件</a></li><li><a href="../html/66-5.Form组件.html">66-5.Form组件</a></li><li><a href="../html/66-6.tree.html">66-6.tree</a></li><li><a href="../html/66-7.vue-router-apply.html">66-7.vue-router-apply</a></li><li><a href="../html/66-8.axios-apply.html">66-8.axios-apply</a></li><li><a href="../html/66-9.vuex-apply.html">66-9.vuex-apply</a></li><li><a href="../html/66-10.jwt-vue.html">66-10.jwt-vue</a></li><li><a href="../html/66-11.vue-ssr.html">66-11.vue-ssr</a></li><li><a href="../html/66-12.nuxt-apply.html">66-12.nuxt-apply</a></li><li><a href="../html/66-13.pwa.html">66-13.pwa</a></li><li><a href="../html/66-14.vue单元测试.html">66-14.vue单元测试</a></li><li><a href="../html/66-15.权限校验.html">66-15.权限校验</a></li><li><a href="../html/67-1-network.html">67-1-network</a></li><li><a href="../html/68-2-wireshark.html">68-2-wireshark</a></li><li><a href="../html/7.npm2.html">7.npm2</a></li><li><a href="../html/69-hooks.html">69-hooks</a></li><li><a href="../html/70-deploy.html">70-deploy</a></li><li><a href="../html/71-hmr.html">71-hmr</a></li><li><a href="../html/72.deploy.html">72.deploy</a></li><li><a href="../html/73.import.html">73.import</a></li><li><a href="../html/74.mobile.html">74.mobile</a></li><li><a href="../html/75.webpack-1.文件分析.html">75.webpack-1.文件分析</a></li><li><a href="../html/75.webpack-2.loader.html">75.webpack-2.loader</a></li><li><a href="../html/75.webpack-3.源码流程.html">75.webpack-3.源码流程</a></li><li><a href="../html/75.webpack-4.tapable.html">75.webpack-4.tapable</a></li><li><a href="../html/75.webpack-5.prepare.html">75.webpack-5.prepare</a></li><li><a href="../html/75.webpack-6.resolve.html">75.webpack-6.resolve</a></li><li><a href="../html/75.webpack-7.loader.html">75.webpack-7.loader</a></li><li><a href="../html/75.webpack-8.module.html">75.webpack-8.module</a></li><li><a href="../html/75.webpack-9.chunk.html">75.webpack-9.chunk</a></li><li><a href="../html/75.webpack-10.asset.html">75.webpack-10.asset</a></li><li><a href="../html/75.webpack-11.实现.html">75.webpack-11.实现</a></li><li><a href="../html/76.react_optimize.html">76.react_optimize</a></li><li><a href="../html/77.ts_ketang_back.html">77.ts_ketang_back</a></li><li><a href="../html/77.ts_ketang_front.html">77.ts_ketang_front</a></li><li><a href="../html/78.vue-domdiff.html">78.vue-domdiff</a></li><li><a href="../html/79.grammar.html">79.grammar</a></li><li><a href="../html/80.tree.html">80.tree</a></li><li><a href="../html/81.axios.html">81.axios</a></li><li><a href="../html/82.1.react.html">82.1.react</a></li><li><a href="../html/82.2.react-high.html">82.2.react-high</a></li><li><a href="../html/82.3.react-router.html">82.3.react-router</a></li><li><a href="../html/82.4.redux.html">82.4.redux</a></li><li><a href="../html/82.5.redux_middleware.html">82.5.redux_middleware</a></li><li><a href="../html/82.6.connected.html">82.6.connected</a></li><li><a href="../html/82.7.saga.html">82.7.saga</a></li><li><a href="../html/82.8.dva.html">82.8.dva</a></li><li><a href="../html/82.8.dva-source.html">82.8.dva-source</a></li><li><a href="../html/82.9.roadhog.html">82.9.roadhog</a></li><li><a href="../html/82.10.umi.html">82.10.umi</a></li><li><a href="../html/82.11.antdesign.html">82.11.antdesign</a></li><li><a href="../html/82.12.ketang-front.html">82.12.ketang-front</a></li><li><a href="../html/82.12.ketang-back.html">82.12.ketang-back</a></li><li><a href="../html/83.upload.html">83.upload</a></li><li><a href="../html/84.graphql.html">84.graphql</a></li><li><a href="../html/85.antpro.html">85.antpro</a></li><li><a href="../html/86.1.uml.html">86.1.uml</a></li><li><a href="../html/86.2.design.html">86.2.design</a></li><li><a href="../html/87.postcss.html">87.postcss</a></li><li><a href="../html/88.react16-1.html">88.react16-1</a></li><li><a href="../html/89.nextjs.html">89.nextjs</a></li><li><a href="../html/90.react-test.html">90.react-test</a></li><li><a href="../html/91.react-ts.html">91.react-ts</a></li><li><a href="../html/92.rbac.html">92.rbac</a></li><li><a href="../html/93.tsnode.html">93.tsnode</a></li><li><a href="../html/94.1.JavaScript.html">94.1.JavaScript</a></li><li><a href="../html/94.2.JavaScript.html">94.2.JavaScript</a></li><li><a href="../html/94.3.MODULE.html">94.3.MODULE</a></li><li><a href="../html/94.4.EventLoop.html">94.4.EventLoop</a></li><li><a href="../html/94.5.文件上传.html">94.5.文件上传</a></li><li><a href="../html/94.6.https.html">94.6.https</a></li><li><a href="../html/94.7. nginx.html">94.7. nginx</a></li><li><a href="../html/95.1. react.html">95.1. react</a></li><li><a href="../html/95.2.react.html">95.2.react</a></li><li><a href="../html/96.1.react16.html">96.1.react16</a></li><li><a href="../html/96.2.fiber.html">96.2.fiber</a></li><li><a href="../html/96.3.fiber.html">96.3.fiber</a></li><li><a href="../html/97.serverless.html">97.serverless</a></li><li><a href="../html/98.websocket.html">98.websocket</a></li><li><a href="../html/100.1.react-basic.html">100.1.react-basic</a></li><li><a href="../html/101.1.monitor.html">101.1.monitor</a></li><li><a href="../html/101.2.monitor.html">101.2.monitor</a></li><li><a href="../html/102.java.html">102.java</a></li><li><a href="../html/103.1.webpack-usage.html">103.1.webpack-usage</a></li><li><a href="../html/103.2.webpack-bundle.html">103.2.webpack-bundle</a></li><li><a href="../html/103.3.webpack-ast.html">103.3.webpack-ast</a></li><li><a href="../html/103.4.webpack-flow.html">103.4.webpack-flow</a></li><li><a href="../html/103.5.webpack-loader.html">103.5.webpack-loader</a></li><li><a href="../html/103.6.webpack-tapable.html">103.6.webpack-tapable</a></li><li><a href="../html/103.7.webpack-plugin.html">103.7.webpack-plugin</a></li><li><a href="../html/103.8.webpack-optimize1.html">103.8.webpack-optimize1</a></li><li><a href="../html/103.9.webpack-optimize2.html">103.9.webpack-optimize2</a></li><li><a href="../html/103.10.webpack-hand.html">103.10.webpack-hand</a></li><li><a href="../html/103.11.webpack-hmr.html">103.11.webpack-hmr</a></li><li><a href="../html/103.13.splitChunks.html">103.13.splitChunks</a></li><li><a href="../html/103.14.webpack-sourcemap.html">103.14.webpack-sourcemap</a></li><li><a href="../html/103.15.webpack-compiler1.html">103.15.webpack-compiler1</a></li><li><a href="../html/103.15.webpack-compiler2.html">103.15.webpack-compiler2</a></li><li><a href="../html/103.16.vite.basic.html">103.16.vite.basic</a></li><li><a href="../html/103.16.vite.source.html">103.16.vite.source</a></li><li><a href="../html/103.17.polyfill.html">103.17.polyfill</a></li><li><a href="../html/104.1.binary.html">104.1.binary</a></li><li><a href="../html/104.2.binary.html">104.2.binary</a></li><li><a href="../html/105.skeleton.html">105.skeleton</a></li><li><a href="../html/106.1.react.html">106.1.react</a></li><li><a href="../html/106.2.react_hooks.html">106.2.react_hooks</a></li><li><a href="../html/106.3.react_router.html">106.3.react_router</a></li><li><a href="../html/106.4.redux.html">106.4.redux</a></li><li><a href="../html/106.5.redux_middleware.html">106.5.redux_middleware</a></li><li><a href="../html/106.6.connected-react-router.html">106.6.connected-react-router</a></li><li><a href="../html/106.6.redux-first-history.html">106.6.redux-first-history</a></li><li><a href="../html/106.7.redux-saga.html">106.7.redux-saga</a></li><li><a href="../html/106.8.dva.html">106.8.dva</a></li><li><a href="../html/106.9.umi.html">106.9.umi</a></li><li><a href="../html/106.10.ketang.html">106.10.ketang</a></li><li><a href="../html/106.11.antdesign.html">106.11.antdesign</a></li><li><a href="../html/106.12.antpro.html">106.12.antpro</a></li><li><a href="../html/106.13.router-6.html">106.13.router-6</a></li><li><a href="../html/107.fiber.html">107.fiber</a></li><li><a href="../html/108.http.html">108.http</a></li><li><a href="../html/109.1.webpack_usage.html">109.1.webpack_usage</a></li><li><a href="../html/109.2.webpack_source.html">109.2.webpack_source</a></li><li><a href="../html/109.3.dll.html">109.3.dll</a></li><li><a href="../html/110.nest.js.html">110.nest.js</a></li><li><a href="../html/111.xstate.html">111.xstate</a></li><li><a href="../html/112.Form.html">112.Form</a></li><li><a href="../html/113.redux-saga.html">113.redux-saga</a></li><li><a href="../html/114.react+typescript.html">114.react+typescript</a></li><li><a href="../html/115.immer.html">115.immer</a></li><li><a href="../html/116.pro5.html">116.pro5</a></li><li><a href="../html/117.css-loader.html">117.css-loader</a></li><li><a href="../html/118.1.umi-core.html">118.1.umi-core</a></li><li><a href="../html/119.2.module-federation.html">119.2.module-federation</a></li><li><a href="../html/119.1.module-federation.html">119.1.module-federation</a></li><li><a href="../html/120.create-react-app.html">120.create-react-app</a></li><li><a href="../html/121.react-scripts.html">121.react-scripts</a></li><li><a href="../html/122.react-optimize.html">122.react-optimize</a></li><li><a href="../html/123.jsx-runtime.html">123.jsx-runtime</a></li><li><a href="../html/124.next.js.html">124.next.js</a></li><li><a href="../html/125.1.linux.html">125.1.linux</a></li><li><a href="../html/125.2.linux-vi.html">125.2.linux-vi</a></li><li><a href="../html/125.3.linux-user.html">125.3.linux-user</a></li><li><a href="../html/125.4.linux-auth.html">125.4.linux-auth</a></li><li><a href="../html/125.5.linux-shell.html">125.5.linux-shell</a></li><li><a href="../html/125.6.linux-install.html">125.6.linux-install</a></li><li><a href="../html/125.7.linux-system.html">125.7.linux-system</a></li><li><a href="../html/125.8.linux-service.html">125.8.linux-service</a></li><li><a href="../html/125.9.linux-network.html">125.9.linux-network</a></li><li><a href="../html/125.10.nginx.html">125.10.nginx</a></li><li><a href="../html/125.11.docker.html">125.11.docker</a></li><li><a href="../html/125.12.ci.html">125.12.ci</a></li><li><a href="../html/125.13.k8s.html">125.13.k8s</a></li><li><a href="../html/125.14.k8s.html">125.14.k8s</a></li><li><a href="../html/125.15.k8s.html">125.15.k8s</a></li><li><a href="../html/125.16.k8s.html">125.16.k8s</a></li><li><a href="../html/126.11.react-1.html">126.11.react-1</a></li><li><a href="../html/126.12.react-2.html">126.12.react-2</a></li><li><a href="../html/126.12.react-3.html">126.12.react-3</a></li><li><a href="../html/126.12.react-4.html">126.12.react-4</a></li><li><a href="../html/126.12.react-5.html">126.12.react-5</a></li><li><a href="../html/127.frontend.html">127.frontend</a></li><li><a href="../html/128.rollup.html">128.rollup</a></li><li><a href="../html/129.px2rem-loader.html">129.px2rem-loader</a></li><li><a href="../html/130.health.html">130.health</a></li><li><a href="../html/131.hooks.html">131.hooks</a></li><li><a href="../html/132.keepalive.html">132.keepalive</a></li><li><a href="../html/133.vue-cli.html">133.vue-cli</a></li><li><a href="../html/134.react18.html">134.react18</a></li><li><a href="../html/135.function.html">135.function</a></li><li><a href="../html/136.toolkit.html">136.toolkit</a></li><li><a href="../html/137.lerna.html">137.lerna</a></li><li><a href="../html/138.create-vite.html">138.create-vite</a></li><li><a href="../html/139.cli.html">139.cli</a></li><li><a href="../html/140.antd.html">140.antd</a></li><li><a href="../html/141.react-dnd.html">141.react-dnd</a></li><li><a href="../html/142.1.link.html">142.1.link</a></li><li><a href="../html/143.1.gulp.html">143.1.gulp</a></li><li><a href="../html/143.2.stream.html">143.2.stream</a></li><li><a href="../html/143.3.gulp.html">143.3.gulp</a></li><li><a href="../html/144.1.closure.html">144.1.closure</a></li><li><a href="../html/144.2.v8.html">144.2.v8</a></li><li><a href="../html/144.3.gc.html">144.3.gc</a></li><li class="active"><a href="../html/145.react-router-v6.html">145.react-router-v6</a></li></ul></div><div class="warpper"><div class="page-toc"><ul><li><a href="#t0内容大纲">内容大纲</a></li><li><a href="#t11. React路由原理">1. React路由原理</a><ul><li><a href="#t21.1 HashRouter">1.1 HashRouter</a></li><li><a href="#t31.2 BrowserRouter">1.2 BrowserRouter</a><ul><li><a href="#t41.2.1 history">1.2.1 history</a><ul><li><a href="#t51.2.1.1 pushState">1.2.1.1 pushState</a></li><li><a href="#t61.2.1.2 replaceState">1.2.1.2 replaceState</a></li><li><a href="#t71.2.1.3 onpopstate">1.2.1.3 onpopstate</a></li><li><a href="#t81.2.1.4 案例">1.2.1.4 案例</a></li></ul></li></ul></li></ul></li><li><a href="#t92.基本路由">2.基本路由</a><ul><li><a href="#t102.1 安装">2.1 安装</a></li><li><a href="#t112.2 src\index.js">2.2 src\index.js</a></li><li><a href="#t122.3 Home.js">2.3 Home.js</a></li><li><a href="#t132.4 Home.js">2.4 Home.js</a></li><li><a href="#t142.4 Profile.js">2.4 Profile.js</a></li></ul></li><li><a href="#t153.实现基本路由">3.实现基本路由</a><ul><li><a href="#t163.1 src\index.js">3.1 src\index.js</a></li><li><a href="#t173.2 RouterContext.js">3.2 RouterContext.js</a></li><li><a href="#t183.3 Router.js">3.3 Router.js</a></li><li><a href="#t193.4 Route.js">3.4 Route.js</a></li><li><a href="#t203.5 react-router\index.js">3.5 react-router\index.js</a></li><li><a href="#t213.6 BrowserRouter.js">3.6 BrowserRouter.js</a></li><li><a href="#t223.7 HashRouter.js">3.7 HashRouter.js</a></li><li><a href="#t233.8 react-router-dom\index.js">3.8 react-router-dom\index.js</a></li></ul></li><li><a href="#t243.实现history">3.实现history</a><ul><li><a href="#t253.1 createBrowserHistory.js">3.1 createBrowserHistory.js</a></li><li><a href="#t263.2 createHashHistory.js">3.2 createHashHistory.js</a></li><li><a href="#t273.3 history\index.js">3.3 history\index.js</a></li><li><a href="#t283.4 BrowserRouter.js">3.4 BrowserRouter.js</a></li><li><a href="#t293.5 HashRouter.js">3.5 HashRouter.js</a></li></ul></li><li><a href="#t304. path-to-regexp">4. path-to-regexp</a><ul><li><a href="#t314.1 /home结束">4.1 /home结束</a></li><li><a href="#t324.2 /home非结束">4.2 /home非结束</a></li><li><a href="#t334.3 路径参数">4.3 路径参数</a></li><li><a href="#t344.4 正则匹配">4.4 正则匹配</a></li></ul></li><li><a href="#t355. 正则匹配">5. 正则匹配</a><ul><li><a href="#t365.1 matchPath.js">5.1 matchPath.js</a></li><li><a href="#t375.2 Router.js">5.2 Router.js</a></li><li><a href="#t385.3 Route.js">5.3 Route.js</a></li><li><a href="#t395.4 react-router\index.js">5.4 react-router\index.js</a></li></ul></li><li><a href="#t406. 实现Switch">6. 实现Switch</a><ul><li><a href="#t416.1 Switch.js">6.1 Switch.js</a></li><li><a href="#t426.2 Route.js">6.2 Route.js</a></li><li><a href="#t436.3 react-router\index.js">6.3 react-router\index.js</a></li><li><a href="#t446.4 src\index.js">6.4 src\index.js</a></li></ul></li><li><a href="#t457. Redirect">7. Redirect</a><ul><li><a href="#t467.1 Redirect.js">7.1 Redirect.js</a></li><li><a href="#t477.2 Lifecycle.js">7.2 Lifecycle.js</a></li><li><a href="#t487.3 react-router\index.js">7.3 react-router\index.js</a></li><li><a href="#t497.4 src\index.js">7.4 src\index.js</a></li></ul></li><li><a href="#t508.Link">8.Link</a><ul><li><a href="#t518.1 Link.js">8.1 Link.js</a></li><li><a href="#t528.2 react-router-dom\index.js">8.2 react-router-dom\index.js</a></li><li><a href="#t538.3 src\index.js">8.3 src\index.js</a></li></ul></li><li><a href="#t549.嵌套路由">9.嵌套路由</a><ul><li><a href="#t559.1 utils.js">9.1 utils.js</a></li><li><a href="#t569.2 User.js">9.2 User.js</a></li><li><a href="#t579.3 UserAdd.js">9.3 UserAdd.js</a></li><li><a href="#t589.4 UserList.js">9.4 UserList.js</a></li><li><a href="#t599.5 UserDetail.js">9.5 UserDetail.js</a></li></ul></li><li><a href="#t6010.受保护路由">10.受保护路由</a><ul><li><a href="#t6110.1 src\index.js">10.1 src\index.js</a></li><li><a href="#t6210.2 Route.js">10.2 Route.js</a></li><li><a href="#t6310.3 Login.js">10.3 Login.js</a></li><li><a href="#t6410.4 Protected.js">10.4 Protected.js</a></li></ul></li><li><a href="#t6511.NavLink">11.NavLink</a><ul><li><a href="#t6611.1 public\index.html">11.1 public\index.html</a></li><li><a href="#t6711.2 src\index.js">11.2 src\index.js</a></li><li><a href="#t6811.3 NavLink.js">11.3 NavLink.js</a></li><li><a href="#t6911.4 react-router-dom\index.js">11.4 react-router-dom\index.js</a></li></ul></li><li><a href="#t7012.withRouter">12.withRouter</a><ul><li><a href="#t7112.1 src\index.js">12.1 src\index.js</a></li><li><a href="#t7212.2 NavHeader.js">12.2 NavHeader.js</a></li><li><a href="#t7312.3 withRouter.js">12.3 withRouter.js</a></li><li><a href="#t7412.4 react-router\index.js">12.4 react-router\index.js</a></li></ul></li><li><a href="#t7513.Prompt">13.Prompt</a><ul><li><a href="#t7613.1 src\index.js">13.1 src\index.js</a></li><li><a href="#t7713.2 UserAdd.js">13.2 UserAdd.js</a></li><li><a href="#t7813.3 Prompt.js">13.3 Prompt.js</a></li><li><a href="#t7913.4 react-router\index.js">13.4 react-router\index.js</a></li><li><a href="#t8013.5 createBrowserHistory.js">13.5 createBrowserHistory.js</a></li></ul></li><li><a href="#t8115.hooks">15.hooks</a><ul><li><a href="#t8215.1 src\index.js">15.1 src\index.js</a></li><li><a href="#t8315.2 hooks.js">15.2 hooks.js</a></li><li><a href="#t8415.3 react-router\index.js">15.3 react-router\index.js</a></li></ul></li><li><a href="#t8516.路由懒加载">16.路由懒加载</a><ul><li><a href="#t8616.1 src\index.js">16.1 src\index.js</a></li></ul></li><li><a href="#t87链接">链接</a></li></ul></div><div class="content markdown-body"><h2 id="t0&#x5185;&#x5BB9;&#x5927;&#x7EB2;">&#x5185;&#x5BB9;&#x5927;&#x7EB2; <a href="#t0&#x5185;&#x5BB9;&#x5927;&#x7EB2;">#</a></h2><ul><li>React&#x8DEF;&#x7531;&#x539F;&#x7406;</li><li>&#x57FA;&#x672C;&#x8DEF;&#x7531;&#x4F7F;&#x7528;&#x548C;&#x5B9E;&#x73B0;</li><li>&#x5B9E;&#x73B0;history</li><li>&#x5B9E;&#x73B0;&#x6B63;&#x5219;&#x5339;&#x914D;</li><li>&#x5B9E;&#x73B0;Switch</li><li>&#x5B9E;&#x73B0;Redirect</li><li>&#x5B9E;&#x73B0;Link</li><li>&#x5B9E;&#x73B0;&#x5D4C;&#x5957;&#x8DEF;&#x7531;</li><li>&#x5B9E;&#x73B0;&#x53D7;&#x4FDD;&#x62A4;&#x8DEF;&#x7531;</li><li>&#x5B9E;&#x73B0;NavLink</li><li>&#x5B9E;&#x73B0;withRouter</li><li>&#x5B9E;&#x73B0;Prompt</li><li>&#x5B9E;&#x73B0;hooks</li></ul><h2 id="t11. React&#x8DEF;&#x7531;&#x539F;&#x7406;">1. React&#x8DEF;&#x7531;&#x539F;&#x7406; <a href="#t11. React&#x8DEF;&#x7531;&#x539F;&#x7406;">#</a></h2><ul><li>&#x4E0D;&#x540C;&#x7684;&#x8DEF;&#x5F84;&#x6E32;&#x67D3;&#x4E0D;&#x540C;&#x7684;&#x7EC4;&#x4EF6;</li><li>&#x6709;&#x4E24;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;<ul><li>HashRouter:&#x5229;&#x7528;hash&#x5B9E;&#x73B0;&#x8DEF;&#x7531;&#x5207;&#x6362;</li><li>BrowserRouter:&#x5B9E;&#x73B0;h5 Api&#x5B9E;&#x73B0;&#x8DEF;&#x7531;&#x7684;&#x5207;&#x6362;</li></ul></li></ul><h3 id="t21.1 HashRouter">1.1 HashRouter <a href="#t21.1 HashRouter">#</a></h3><ul><li>&#x5229;&#x7528;hash&#x5B9E;&#x73B0;&#x8DEF;&#x7531;&#x5207;&#x6362;</li></ul><p>public\index.html</p><pre><code class="lang-js">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;style&gt;
        #root{
            border:1px solid red;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;
    &lt;ul&gt;
        &lt;li&gt;&lt;a href=&quot;#/a&quot;&gt;/a&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;#/b&quot;&gt;/b&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
    &lt;script&gt;
        window.addEventListener(&apos;hashchange&apos;,()=&gt;{
            console.log(window.location.hash);
            let pathname = window.location.hash.slice(1);//&#x628A;&#x6700;&#x524D;&#x9762;&#x7684;&#x90A3;&#x4E2A;#&#x5220;&#x9664; 
            root.innerHTML = pathname;
        });

    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="t31.2 BrowserRouter">1.2 BrowserRouter <a href="#t31.2 BrowserRouter">#</a></h3><ul><li>&#x5229;&#x7528;h5 Api&#x5B9E;&#x73B0;&#x8DEF;&#x7531;&#x7684;&#x5207;&#x6362;</li></ul><h4 id="t41.2.1 history">1.2.1 history <a href="#t41.2.1 history">#</a></h4><ul><li>HTML5&#x89C4;&#x8303;&#x7ED9;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/history">history</a>&#x63A5;&#x53E3;</li><li>HTML5 History API&#x5305;&#x62EC;2&#x4E2A;&#x65B9;&#x6CD5;&#xFF1A;<code>history.pushState()</code>&#x548C;<code>history.replaceState()</code>&#xFF0C;&#x548C;1&#x4E2A;&#x4E8B;&#x4EF6;<code>window.onpopstate</code></li></ul><h5 id="t51.2.1.1 pushState">1.2.1.1 pushState <a href="#t51.2.1.1 pushState">#</a></h5><ul><li>history.pushState(stateObject, title, url)&#xFF0C;&#x5305;&#x62EC;&#x4E09;&#x4E2A;&#x53C2;&#x6570;<ul><li>&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x8BE5;url&#x5BF9;&#x5E94;&#x7684;&#x72B6;&#x6001;&#x5BF9;&#x8C61;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x53EF;&#x5728;onpopstate&#x4E8B;&#x4EF6;&#x4E2D;&#x83B7;&#x53D6;&#xFF0C;&#x4E5F;&#x53EF;&#x5728;history&#x5BF9;&#x8C61;&#x4E2D;&#x83B7;&#x53D6;</li><li>&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x6807;&#x9898;&#xFF0C;&#x76EE;&#x524D;&#x6D4F;&#x89C8;&#x5668;&#x5E76;&#x672A;&#x5B9E;&#x73B0;</li><li>&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x5219;&#x662F;&#x8BBE;&#x5B9A;&#x7684;url</li></ul></li><li>pushState&#x51FD;&#x6570;&#x5411;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5386;&#x53F2;&#x5806;&#x6808;&#x538B;&#x5165;&#x4E00;&#x4E2A;url&#x4E3A;&#x8BBE;&#x5B9A;&#x503C;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x5E76;&#x6539;&#x53D8;&#x5386;&#x53F2;&#x5806;&#x6808;&#x7684;&#x5F53;&#x524D;&#x6307;&#x9488;&#x81F3;&#x6808;&#x9876;</li></ul><h5 id="t61.2.1.2 replaceState">1.2.1.2 replaceState <a href="#t61.2.1.2 replaceState">#</a></h5><ul><li>&#x8BE5;&#x63A5;&#x53E3;&#x4E0E;pushState&#x53C2;&#x6570;&#x76F8;&#x540C;&#xFF0C;&#x542B;&#x4E49;&#x4E5F;&#x76F8;&#x540C;</li><li>&#x552F;&#x4E00;&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;<code>replaceState</code>&#x662F;&#x66FF;&#x6362;&#x6D4F;&#x89C8;&#x5668;&#x5386;&#x53F2;&#x5806;&#x6808;&#x7684;&#x5F53;&#x524D;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x4E3A;&#x8BBE;&#x5B9A;&#x7684;url</li><li>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;<code>replaceState</code>&#x4E0D;&#x4F1A;&#x6539;&#x52A8;&#x6D4F;&#x89C8;&#x5668;&#x5386;&#x53F2;&#x5806;&#x6808;&#x7684;&#x5F53;&#x524D;&#x6307;&#x9488;</li></ul><h5 id="t71.2.1.3 onpopstate">1.2.1.3 onpopstate <a href="#t71.2.1.3 onpopstate">#</a></h5><ul><li>&#x8BE5;&#x4E8B;&#x4EF6;&#x662F;window&#x7684;&#x5C5E;&#x6027;</li><li>&#x8BE5;&#x4E8B;&#x4EF6;&#x4F1A;&#x5728;&#x8C03;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x524D;&#x8FDB;&#x3001;&#x540E;&#x9000;&#x4EE5;&#x53CA;&#x6267;&#x884C;<code>history.forward</code>&#x3001;<code>history.back</code>&#x3001;&#x548C;<code>history.go</code>&#x89E6;&#x53D1;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x6709;&#x4E00;&#x4E2A;&#x5171;&#x6027;&#xFF0C;&#x5373;&#x4FEE;&#x6539;&#x4E86;&#x5386;&#x53F2;&#x5806;&#x6808;&#x7684;&#x5F53;&#x524D;&#x6307;&#x9488;</li><li>&#x5728;&#x4E0D;&#x6539;&#x53D8;document&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x4E00;&#x65E6;&#x5F53;&#x524D;&#x6307;&#x9488;&#x6539;&#x53D8;&#x5219;&#x4F1A;&#x89E6;&#x53D1;<code>onpopstate</code>&#x4E8B;&#x4EF6;</li></ul><h5 id="t81.2.1.4 &#x6848;&#x4F8B;">1.2.1.4 &#x6848;&#x4F8B; <a href="#t81.2.1.4 &#x6848;&#x4F8B;">#</a></h5><ul><li>&#x6D4F;&#x89C8;&#x5668;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;&#x9875;&#x9762;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;<code>History</code>&#x6808;,&#x6267;&#x884C;<code>pushState</code>&#x51FD;&#x6570;&#x53EF;&#x538B;&#x5165;&#x8BBE;&#x5B9A;&#x7684;<code>url</code>&#x81F3;&#x6808;&#x9876;,&#x540C;&#x65F6;&#x4FEE;&#x6539;&#x5F53;&#x524D;&#x6307;&#x9488;</li><li>&#x5F53;&#x6267;&#x884C;<code>back</code>&#x548C;<code>forward</code>&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;history&#x6808;&#x5927;&#x5C0F;&#x5E76;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#xFF08;history.length&#x4E0D;&#x53D8;&#xFF09;&#xFF0C;&#x4EC5;&#x4EC5;&#x79FB;&#x52A8;&#x5F53;&#x524D;&#x6307;&#x9488;&#x7684;&#x4F4D;&#x7F6E;</li><li>&#x82E5;&#x5F53;&#x524D;&#x6307;&#x9488;&#x5728;history&#x6808;&#x7684;&#x4E2D;&#x95F4;&#x4F4D;&#x7F6E;(&#x975E;&#x6808;&#x9876;)&#xFF0C;&#x6B64;&#x65F6;&#x6267;&#x884C;pushState&#x4F1A;&#x5728;&#x6307;&#x9488;&#x5F53;&#x524D;&#x7684;&#x4F4D;&#x7F6E;&#x6DFB;&#x52A0;&#x6B64;&#x6761;&#x76EE;,&#x5E76;&#x6210;&#x4E3A;&#x65B0;&#x7684;&#x6808;&#x9876;</li></ul><pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-id">#root</span>{
            <span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid red;
            <span class="hljs-attribute">height</span>:<span class="hljs-number">20px</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">var</span> historyObj = <span class="hljs-built_in">window</span>.history;
        <span class="hljs-comment">//&#x76D1;&#x542C;&#x8DEF;&#x5F84;&#x6539;&#x53D8;&#x4E8B;&#x4EF6; &#x8868;&#x793A;&#x5C06;&#x5F53;&#x524D;&#x7684;&#x72B6;&#x6001;&#x53D8;&#x66F4;&#x4E86;&#xFF0C;&#x5F39;&#x51FA;&#x4E86;</span>
        <span class="hljs-built_in">window</span>.onpushstate = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
            <span class="hljs-built_in">console</span>.log(event.type,event.detail.state);
            root.innerHTML = <span class="hljs-built_in">window</span>.location.pathname;
        }
        <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">&apos;popstate&apos;</span>, (event) =&gt; {
            <span class="hljs-built_in">console</span>.log(event.type,event.state);
            root.innerHTML = <span class="hljs-built_in">window</span>.location.pathname;
        });

        (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">historyObj</span>) </span>{
            <span class="hljs-keyword">let</span> oldPushState = history.pushState;<span class="hljs-comment">//&#x7F13;&#x5B58;&#x539F;&#x751F;&#x7684;pushState</span>
            historyObj.pushState = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">state, title, pathname</span>) </span>{
                <span class="hljs-keyword">let</span> result = oldPushState.apply(history, <span class="hljs-built_in">arguments</span>);
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span>.onpushstate === <span class="hljs-string">&apos;function&apos;</span>) {
                    <span class="hljs-built_in">window</span>.onpushstate(<span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">&apos;pushstate&apos;</span>,{<span class="hljs-attr">detail</span>:{pathname,state}}));
                }
                <span class="hljs-keyword">return</span> result;
            }
        })(historyObj);
        <span class="hljs-keyword">let</span> oldHistoryLength = historyObj.length;
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            historyObj.pushState({ <span class="hljs-attr">page</span>: <span class="hljs-number">1</span> }, { <span class="hljs-attr">title</span>: <span class="hljs-string">&apos;page1&apos;</span> }, <span class="hljs-string">&apos;/page1&apos;</span>);<span class="hljs-comment">//page1</span>
            <span class="hljs-built_in">console</span>.log(historyObj.length-oldHistoryLength);
        }, <span class="hljs-number">1000</span>);
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            historyObj.pushState({ <span class="hljs-attr">page</span>: <span class="hljs-number">2</span> }, { <span class="hljs-attr">title</span>: <span class="hljs-string">&apos;page2&apos;</span> }, <span class="hljs-string">&apos;/page2&apos;</span>);<span class="hljs-comment">//page2</span>
            <span class="hljs-built_in">console</span>.log(historyObj.length-oldHistoryLength);
        }, <span class="hljs-number">2000</span>);
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            historyObj.pushState({ <span class="hljs-attr">page</span>: <span class="hljs-number">3</span> }, { <span class="hljs-attr">title</span>: <span class="hljs-string">&apos;page3&apos;</span> }, <span class="hljs-string">&apos;/page3&apos;</span>);<span class="hljs-comment">//page3</span>
            <span class="hljs-built_in">console</span>.log(historyObj.length-oldHistoryLength);
        }, <span class="hljs-number">3000</span>);
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            historyObj.back();<span class="hljs-comment">//historyObj.go(-1);//page2</span>
            setTimeout(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span><span class="hljs-built_in">console</span>.log(historyObj.length-oldHistoryLength),<span class="hljs-number">100</span>);

        }, <span class="hljs-number">4000</span>);
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            historyObj.pushState({ <span class="hljs-attr">page</span>:<span class="hljs-number">4</span> }, { <span class="hljs-attr">title</span>: <span class="hljs-string">&apos;page4&apos;</span> }, <span class="hljs-string">&apos;/page4&apos;</span>);<span class="hljs-comment">//page4</span>
            <span class="hljs-built_in">console</span>.log(historyObj.length-oldHistoryLength);
        }, <span class="hljs-number">5000</span>);
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            historyObj.go(<span class="hljs-number">1</span>);
            <span class="hljs-built_in">console</span>.log(historyObj.length-oldHistoryLength);<span class="hljs-comment">//page4</span>
        }, <span class="hljs-number">6000</span>);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre><h2 id="t92.&#x57FA;&#x672C;&#x8DEF;&#x7531;">2.&#x57FA;&#x672C;&#x8DEF;&#x7531; <a href="#t92.&#x57FA;&#x672C;&#x8DEF;&#x7531;">#</a></h2><h3 id="t102.1 &#x5B89;&#x88C5;">2.1 &#x5B89;&#x88C5; <a href="#t102.1 &#x5B89;&#x88C5;">#</a></h3><pre><code class="lang-js">npm i react-router-dom --save
</code></pre><h3 id="t112.2 src\index.js">2.2 src\index.js <a href="#t112.2 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-keyword">import</span> {HashRouter <span class="hljs-keyword">as</span> Router,Route} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-router-dom&apos;</span>;
<span class="hljs-keyword">import</span> Home <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./components/Home&apos;</span>;
<span class="hljs-keyword">import</span> User <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./components/User&apos;</span>;
<span class="hljs-keyword">import</span> Profile <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./components/Profile&apos;</span>;
ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Home}</span> <span class="hljs-attr">exact</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/user&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{User}</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/profile&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Profile}/</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>
,<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>));
</code></pre><h3 id="t122.3 Home.js">2.3 Home.js <a href="#t122.3 Home.js">#</a></h3><p>src\components\Home.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React,{Component} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Home</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    render(){
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.props);
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span> 
             <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span>=&gt;</span>this.props.history.push({pathname:&apos;/user&apos;,state:{id:1}})}&gt;&#x8DF3;&#x8F6C;&#x5230;/user<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}
</code></pre><h3 id="t132.4 Home.js">2.4 Home.js <a href="#t132.4 Home.js">#</a></h3><p>src\components\User.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React,{Component} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    render(){
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.props.location.state);
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>User<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span>=&gt;</span>this.props.history.goBack()}&gt;&#x8FD4;&#x56DE;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}
<span class="hljs-comment">/**
{
    &quot;history&quot;: {
        &quot;length&quot;: 3,
        &quot;action&quot;: &quot;POP&quot;,
        &quot;location&quot;: {
            &quot;pathname&quot;: &quot;/user&quot;,
            &quot;search&quot;: &quot;&quot;,
            &quot;hash&quot;: &quot;&quot;
        }
    },
    &quot;location&quot;: {
        &quot;pathname&quot;: &quot;/user&quot;,
        &quot;search&quot;: &quot;&quot;,
        &quot;hash&quot;: &quot;&quot;
    },
    &quot;match&quot;: {
        &quot;path&quot;: &quot;/user&quot;,
        &quot;url&quot;: &quot;/user&quot;,
        &quot;isExact&quot;: true,
        &quot;params&quot;: {}
    }
}
 */</span>
</code></pre><h3 id="t142.4 Profile.js">2.4 Profile.js <a href="#t142.4 Profile.js">#</a></h3><p>src\components\Profile.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React,{Component} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Profile</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span></span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Profile<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}
</code></pre><h2 id="t153.&#x5B9E;&#x73B0;&#x57FA;&#x672C;&#x8DEF;&#x7531;">3.&#x5B9E;&#x73B0;&#x57FA;&#x672C;&#x8DEF;&#x7531; <a href="#t153.&#x5B9E;&#x73B0;&#x57FA;&#x672C;&#x8DEF;&#x7531;">#</a></h2><h3 id="t163.1 src\index.js">3.1 src\index.js <a href="#t163.1 src\index.js">#</a></h3><ul><li><a href="https://gitee.com/zhufengpeixun/react-router/blob/master/packages/react-router-dom/modules/index.js">react-router-dom/modules/index.js</a></li></ul><pre><code class="lang-diff">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
<span class="hljs-addition">+import {HashRouter as Router,Route} from &apos;./react-router-dom&apos;;</span>
import Home from &apos;./components/Home&apos;;
import User from &apos;./components/User&apos;;
import Profile from &apos;./components/Profile&apos;;
ReactDOM.render(
    &lt;Router&gt;
        &lt;div&gt;
          &lt;Route path=&quot;/&quot; component={Home} exact/&gt;
          &lt;Route path=&quot;/user&quot; component={User} /&gt;
          &lt;Route path=&quot;/profile&quot; component={Profile}/&gt;
        &lt;/div&gt;
    &lt;/Router&gt;
,document.getElementById(&apos;root&apos;));
</code></pre><h3 id="t173.2 RouterContext.js">3.2 RouterContext.js <a href="#t173.2 RouterContext.js">#</a></h3><p>src\react-router\RouterContext.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> React.createContext({});
</code></pre><h3 id="t183.3 Router.js">3.3 Router.js <a href="#t183.3 Router.js">#</a></h3><p>src\react-router\Router.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>
<span class="hljs-keyword">import</span> RouterContext <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./RouterContext&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Router</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    <span class="hljs-keyword">constructor</span>(props){
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = {
            <span class="hljs-attr">location</span>:props.history.location
        }
        <span class="hljs-comment">//&#x5F53;&#x8DEF;&#x5F84;&#x53D1;&#x751F;&#x7684;&#x53D8;&#x5316;&#x7684;&#x65F6;&#x5019;&#x6267;&#x884C;&#x56DE;&#x8C03;</span>
        <span class="hljs-keyword">this</span>.unlisten = props.history.listen(<span class="hljs-function">(<span class="hljs-params">location</span>)=&gt;</span>{
            <span class="hljs-keyword">this</span>.setState({location});
        });
    }
    componentWillUnmount(){
        <span class="hljs-keyword">this</span>.unlisten&amp;&amp;<span class="hljs-keyword">this</span>.unlisten();
    }
    render(){
        <span class="hljs-keyword">let</span> value = {<span class="hljs-comment">//&#x901A;&#x8FC7;value&#x5411;&#x4E0B;&#x5C42;&#x4F20;&#x9012;&#x6570;&#x636E;</span>
            <span class="hljs-attr">location</span>:<span class="hljs-keyword">this</span>.state.location,
            <span class="hljs-attr">history</span>:<span class="hljs-keyword">this</span>.props.history
        }
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RouterContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span>&gt;</span>
                {this.props.children}
            <span class="hljs-tag">&lt;/<span class="hljs-name">RouterContext.Provider</span>&gt;</span></span>
        )
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Router;
</code></pre><h3 id="t193.4 Route.js">3.4 Route.js <a href="#t193.4 Route.js">#</a></h3><p>src\react-router\Route.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>
<span class="hljs-keyword">import</span> RouterContext <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./RouterContext&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Route</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    <span class="hljs-keyword">static</span> contextType = RouterContext
    render(){
        <span class="hljs-keyword">const</span> {history,location} = <span class="hljs-keyword">this</span>.context;
        <span class="hljs-keyword">const</span> {path,<span class="hljs-attr">component</span>:RouteComponent} = <span class="hljs-keyword">this</span>.props;
        <span class="hljs-keyword">const</span> match = location.pathname === path;
        <span class="hljs-keyword">let</span> routeProps = {history,location};
        <span class="hljs-keyword">let</span> element=<span class="hljs-literal">null</span>;
        <span class="hljs-keyword">if</span>(match){
            element= <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RouteComponent</span> {<span class="hljs-attr">...routeProps</span>}/&gt;</span></span>
        }
        <span class="hljs-keyword">return</span> element;
    }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Route;
</code></pre><h3 id="t203.5 react-router\index.js">3.5 react-router\index.js <a href="#t203.5 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-js"><span class="hljs-keyword">export</span> {<span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> Route} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./Route&apos;</span>;
<span class="hljs-keyword">export</span> {<span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> Router} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./Router&apos;</span>;
<span class="hljs-keyword">export</span> {<span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> __RouterContext} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./RouterContext&apos;</span>;
</code></pre><h3 id="t213.6 BrowserRouter.js">3.6 BrowserRouter.js <a href="#t213.6 BrowserRouter.js">#</a></h3><p>src\react-router-dom\BrowserRouter.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>
<span class="hljs-keyword">import</span> {Router} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../react-router&apos;</span>;
<span class="hljs-keyword">import</span> {createBrowserHistory} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;history&apos;</span>;
<span class="hljs-comment">//&#x521B;&#x5EFA;&#x76F8;&#x5E94;&#x7684;&#x5386;&#x53F2;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4E14;&#x4F20;&#x5165;Router&#x7EC4;&#x4EF6;&#xFF0C;&#x539F;&#x6837;&#x6E32;&#x67D3;&#x5B50;&#x7EC4;&#x4EF6;</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BrowserRouter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    <span class="hljs-comment">//&#x4E0D;&#x7BA1;&#x662F;&#x54EA;&#x79CD;&#x521B;&#x5EFA;&#x5386;&#x53F2;&#x5BF9;&#x8C61;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5F97;&#x5230;&#x7684;history &#x957F;&#x7684;&#x90FD;&#x4E00;&#x6837;&#xFF0C;&#x90FD;&#x50CF;window.history</span>
    history = createBrowserHistory(<span class="hljs-keyword">this</span>.props)<span class="hljs-comment">//window.history</span>
    render(){
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span> <span class="hljs-attr">history</span>=<span class="hljs-string">{this.history}</span>&gt;</span>
                {this.props.children}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>
        )
    }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> BrowserRouter;
</code></pre><h3 id="t223.7 HashRouter.js">3.7 HashRouter.js <a href="#t223.7 HashRouter.js">#</a></h3><p>src\react-router-dom\HashRouter.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>
<span class="hljs-keyword">import</span> {Router} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../react-router&apos;</span>;
<span class="hljs-keyword">import</span> {createHashHistory} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;history&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HashRouter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    history = createHashHistory()<span class="hljs-comment">//hash&#x5B9E;&#x73B0;</span>
    render(){
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span> <span class="hljs-attr">history</span>=<span class="hljs-string">{this.history}</span>&gt;</span>
                {this.props.children}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>
        )
    }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> HashRouter;
</code></pre><h3 id="t233.8 react-router-dom\index.js">3.8 react-router-dom\index.js <a href="#t233.8 react-router-dom\index.js">#</a></h3><p>src\react-router-dom\index.js</p><pre><code class="lang-js"><span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../react-router&apos;</span>;
<span class="hljs-keyword">export</span> {<span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> HashRouter} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./HashRouter&apos;</span>;
<span class="hljs-keyword">export</span> {<span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> BrowserRouter} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./BrowserRouter&apos;</span>;
</code></pre><h2 id="t243.&#x5B9E;&#x73B0;history">3.&#x5B9E;&#x73B0;history <a href="#t243.&#x5B9E;&#x73B0;history">#</a></h2><h3 id="t253.1 createBrowserHistory.js">3.1 createBrowserHistory.js <a href="#t253.1 createBrowserHistory.js">#</a></h3><p>src\history\createBrowserHistory.js</p><pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createBrowserHistory</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">const</span> globalHistory = <span class="hljs-built_in">window</span>.history;
    <span class="hljs-keyword">let</span> listeners = [];<span class="hljs-comment">//&#x5B58;&#x653E;&#x6240;&#x6709;&#x7684;&#x76D1;&#x542C;&#x51FD;&#x6570;</span>
    <span class="hljs-keyword">let</span> state;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listen</span>(<span class="hljs-params">listener</span>)</span>{
        listeners.push(listener);
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
            listeners = listeners.filter(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span>item!=listener);
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span>(<span class="hljs-params">n</span>)</span>{
        globalHistory.go(n);
    }
    <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">&apos;popstate&apos;</span>,()=&gt;{<span class="hljs-comment">//TODO</span>
        <span class="hljs-keyword">let</span> location = {<span class="hljs-attr">state</span>:globalHistory.state,<span class="hljs-attr">pathname</span>:<span class="hljs-built_in">window</span>.location.pathname};
        <span class="hljs-comment">//&#x5F53;&#x8DEF;&#x5F84;&#x6539;&#x53D8;&#x4E4B;&#x540E;&#x5E94;&#x8BE5;&#x8BA9;history&#x7684;&#x76D1;&#x542C;&#x51FD;&#x6570;&#x6267;&#x884C;&#xFF0C;&#x91CD;&#x65B0;&#x5237;&#x65B0;&#x7EC4;&#x4EF6;</span>
        notify({<span class="hljs-attr">action</span>:<span class="hljs-string">&quot;POP&quot;</span>,location});
    });
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goBack</span>(<span class="hljs-params"></span>)</span>{
        go(<span class="hljs-number">-1</span>);
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goForward</span>(<span class="hljs-params"></span>)</span>{
        go(<span class="hljs-number">1</span>);
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">notify</span>(<span class="hljs-params">newState</span>)</span>{
        <span class="hljs-comment">//&#x628A;newState&#x4E0A;&#x7684;&#x5C5E;&#x6027;&#x8D4B;&#x503C;&#x5230;history&#x5BF9;&#x8C61;&#x4E0A;</span>
        <span class="hljs-built_in">Object</span>.assign(history,newState);
        history.length = globalHistory.length;<span class="hljs-comment">//&#x8DEF;&#x7531;&#x5386;&#x53F2;&#x6808;&#x4E2D;&#x5386;&#x53F2;&#x6761;&#x76EE;&#x7684;&#x957F;&#x5EA6;</span>
        listeners.forEach(<span class="hljs-function"><span class="hljs-params">listener</span>=&gt;</span>listener(history.location));<span class="hljs-comment">//&#x901A;&#x77E5;&#x76D1;&#x542C;&#x51FD;&#x6570;&#x6267;&#x884C;,&#x53C2;&#x6570;&#x662F;&#x65B0;&#x7684;location</span>
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">push</span>(<span class="hljs-params">pathname,nextState</span>)</span>{<span class="hljs-comment">//TODO</span>
        <span class="hljs-keyword">const</span> action = <span class="hljs-string">&apos;PUSH&apos;</span>;<span class="hljs-comment">//action&#x8868;&#x793A;&#x662F;&#x7531;&#x4E8E;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x52A8;&#x4F5C;&#x5F15;&#x8D77;&#x4E86;&#x8DEF;&#x5F84;&#x7684;&#x53D8;&#x66F4;</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> pathname === <span class="hljs-string">&apos;object&apos;</span>){
            state = pathname.state;
            pathname = pathname.pathname;
        }<span class="hljs-keyword">else</span>{
            state=nextState;<span class="hljs-comment">//TODO </span>
        }
        globalHistory.pushState(state,<span class="hljs-literal">null</span>,pathname);<span class="hljs-comment">//&#x6211;&#x4EEC;&#x5DF2;&#x7ECF; &#x8DF3;&#x8F6C;&#x8DEF;&#x5F84;</span>
        <span class="hljs-keyword">let</span> location = {state,pathname};
        notify({action,location});
    }
    <span class="hljs-keyword">const</span> history = {
        <span class="hljs-attr">action</span>:<span class="hljs-string">&apos;POP&apos;</span>,
        go,
        goBack,
        goForward,
        push,
        listen,
        <span class="hljs-attr">location</span>:{<span class="hljs-attr">pathname</span>:<span class="hljs-built_in">window</span>.location.pathname,<span class="hljs-attr">state</span>:<span class="hljs-built_in">window</span>.location.state}
    }
    <span class="hljs-keyword">return</span> history;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> createBrowserHistory;
</code></pre><h3 id="t263.2 createHashHistory.js">3.2 createHashHistory.js <a href="#t263.2 createHashHistory.js">#</a></h3><p>src\history\createHashHistory.js</p><pre><code class="lang-js"><span class="hljs-comment">/**
 * hash&#x4E0D;&#x80FD;&#x4F7F;&#x7528; &#x6D4F;&#x89C8;&#x5668;&#x7684;history&#x5BF9;&#x8C61;&#x4E86;
 * <span class="hljs-doctag">@returns </span>
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHashHistory</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">let</span> stack = [];<span class="hljs-comment">//&#x7C7B;&#x4F3C;&#x4E8E;&#x5386;&#x53F2;&#x6808; &#x91CC;&#x9762;&#x5B58;&#x653E;&#x90FD;&#x662F;&#x8DEF;&#x5F84;</span>
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">-1</span>;<span class="hljs-comment">//&#x6808;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;-1</span>
    <span class="hljs-keyword">let</span> action = <span class="hljs-string">&apos;POP&apos;</span>;<span class="hljs-comment">//&#x52A8;&#x4F5C;</span>
    <span class="hljs-keyword">let</span> state ;<span class="hljs-comment">//&#x6700;&#x65B0;&#x7684;&#x72B6;&#x6001; </span>
    <span class="hljs-keyword">let</span> listeners = [];<span class="hljs-comment">//&#x76D1;&#x542C;&#x51FD;&#x6570;&#x7684;&#x6570;&#x7EC4;</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listen</span>(<span class="hljs-params">listener</span>)</span>{
        listeners.push(listener);
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
            listeners = listeners.filter(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span>item!=listener);
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span>(<span class="hljs-params">n</span>)</span>{
        action = <span class="hljs-string">&apos;POP&apos;</span>;
        index+=n;<span class="hljs-comment">//&#x66F4;&#x6539;&#x6808;&#x9876;&#x7684;&#x6307;&#x9488;</span>
        <span class="hljs-keyword">let</span> nextLocation = stack[index];<span class="hljs-comment">//&#x53D6;&#x51FA;&#x6307;&#x5B9A;&#x7D22;&#x5F15;&#x5BF9;&#x5E94;&#x7684;&#x8DEF;&#x5F84;&#x5BF9;&#x8C61;</span>
        state= nextLocation.state;<span class="hljs-comment">//&#x53D6;&#x51FA;&#x6B64;location&#x5BF9;&#x5E94;&#x7684;&#x72B6;&#x6001; </span>
        <span class="hljs-built_in">window</span>.location.hash = nextLocation.pathname;<span class="hljs-comment">//&#x4FEE;&#x6539;hash&#x503C; &#xFF0C;&#x4ECE;&#x800C;&#x4FEE;&#x6539;&#x5F53;&#x524D;&#x7684;&#x8DEF;&#x5F84;</span>
    }
    <span class="hljs-keyword">let</span> hashChangeHandler = <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
        <span class="hljs-keyword">let</span> pathname = <span class="hljs-built_in">window</span>.location.hash.slice(<span class="hljs-number">1</span>);<span class="hljs-comment">//&#x53D6;&#x51FA;&#x6700;&#x65B0;&#x7684;hash&#x503C;&#x5BF9;&#x5E94;&#x7684;&#x8DEF;&#x5F84;  #/user</span>
        <span class="hljs-built_in">Object</span>.assign(history,{action,<span class="hljs-attr">location</span>:{pathname,state}});
        <span class="hljs-keyword">if</span>(action === <span class="hljs-string">&apos;PUSH&apos;</span>){<span class="hljs-comment">//&#x8BF4;&#x660E;&#x662F;&#x8C03;&#x7528;push&#x65B9;&#x6CD5;&#xFF0C;&#x9700;&#x8981;&#x5F80;&#x5386;&#x53F2;&#x6808;&#x4E2D;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x6761;&#x76EE; </span>
            stack[++index]=history.location;
        }
        listeners.forEach(<span class="hljs-function"><span class="hljs-params">listener</span>=&gt;</span>listener(history.location));
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">push</span>(<span class="hljs-params">pathname,nextState</span>)</span>{
        action = <span class="hljs-string">&apos;PUSH&apos;</span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> pathname ===<span class="hljs-string">&apos;object&apos;</span>){
            state = pathname.state;
            pathname = pathname.pathname
        }<span class="hljs-keyword">else</span>{
            state = nextState;
        }
        <span class="hljs-built_in">window</span>.location.hash = pathname;
    }
    <span class="hljs-comment">//&#x5F53;hash&#x53D1;&#x751F;&#x53D8;&#x5316;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x6267;&#x884C;&#x56DE;&#x8C03;</span>
    <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">&apos;hashchange&apos;</span>,hashChangeHandler);
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goBack</span>(<span class="hljs-params"></span>)</span>{
        go(<span class="hljs-number">-1</span>);
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goForward</span>(<span class="hljs-params"></span>)</span>{
        go(<span class="hljs-number">1</span>);
    }
    <span class="hljs-keyword">const</span> history = {
        <span class="hljs-attr">action</span>:<span class="hljs-string">&apos;POP&apos;</span>,
        go,
        goBack,
        goForward,
        push,
        listen,
        <span class="hljs-attr">location</span>:{},
        <span class="hljs-attr">location</span>:{<span class="hljs-attr">pathname</span>:<span class="hljs-string">&apos;/&apos;</span>,<span class="hljs-attr">state</span>:<span class="hljs-literal">undefined</span>}
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">window</span>.location.hash){<span class="hljs-comment">//&#x5982;&#x679C;&#x521D;&#x59CB;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5982;&#x679C;hash&#x662F;&#x6709;&#x503C;&#x7684;</span>
        action = <span class="hljs-string">&apos;PUSH&apos;</span>;
        hashChangeHandler();
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-built_in">window</span>.location.hash = <span class="hljs-string">&apos;/&apos;</span>;
    }
    <span class="hljs-keyword">return</span> history;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> createHashHistory;
</code></pre><h3 id="t273.3 history\index.js">3.3 history\index.js <a href="#t273.3 history\index.js">#</a></h3><p>src\history\index.js</p><pre><code class="lang-js"><span class="hljs-keyword">export</span> {<span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> createBrowserHistory} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./createBrowserHistory&apos;</span>;
<span class="hljs-keyword">export</span> {<span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> createHashHistory} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./createHashHistory&apos;</span>;
</code></pre><h3 id="t283.4 BrowserRouter.js">3.4 BrowserRouter.js <a href="#t283.4 BrowserRouter.js">#</a></h3><p>src\react-router-dom\BrowserRouter.js</p><pre><code class="lang-diff">import React from &apos;react&apos;
import {Router} from &apos;../react-router&apos;;
<span class="hljs-addition">+import {createBrowserHistory} from &apos;../history&apos;;</span>
//&#x521B;&#x5EFA;&#x76F8;&#x5E94;&#x7684;&#x5386;&#x53F2;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4E14;&#x4F20;&#x5165;Router&#x7EC4;&#x4EF6;&#xFF0C;&#x539F;&#x6837;&#x6E32;&#x67D3;&#x5B50;&#x7EC4;&#x4EF6;
class BrowserRouter extends React.Component{
    //&#x4E0D;&#x7BA1;&#x662F;&#x54EA;&#x79CD;&#x521B;&#x5EFA;&#x5386;&#x53F2;&#x5BF9;&#x8C61;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5F97;&#x5230;&#x7684;history &#x957F;&#x7684;&#x90FD;&#x4E00;&#x6837;&#xFF0C;&#x90FD;&#x50CF;window.history
    history = createBrowserHistory(this.props)//window.history
    render(){
        return (
            &lt;Router history={this.history}&gt;
                {this.props.children}
            &lt;/Router&gt;
        )
    }
}
export default BrowserRouter;
</code></pre><h3 id="t293.5 HashRouter.js">3.5 HashRouter.js <a href="#t293.5 HashRouter.js">#</a></h3><p>src\react-router-dom\HashRouter.js</p><pre><code class="lang-diff">import React from &apos;react&apos;
import {Router} from &apos;../react-router&apos;;
import {createHashHistory} from &apos;../history&apos;;
class HashRouter extends React.Component{
    history = createHashHistory()//hash&#x5B9E;&#x73B0;
    render(){
        return (
            &lt;Router history={this.history}&gt;
                {this.props.children}
            &lt;/Router&gt;
        )
    }
}
export default HashRouter;
</code></pre><h2 id="t304. path-to-regexp">4. path-to-regexp <a href="#t304. path-to-regexp">#</a></h2><ul><li><a href="https://jex.im/regulex">regulex</a></li><li><a href="https://www.npmjs.com/package/path-to-regexp">path-to-regexp</a><ul><li>sensitive &#x662F;&#x5426;&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F; (&#x9ED8;&#x8BA4;&#x503C;: false)</li><li>strict &#x662F;&#x5426;&#x5141;&#x8BB8;&#x7ED3;&#x5C3E;&#x6709;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x7684;/ (&#x9ED8;&#x8BA4;&#x503C;: false)</li><li>end &#x662F;&#x5426;&#x5339;&#x914D;&#x6574;&#x4E2A;&#x5B57;&#x7B26;&#x4E32; (&#x9ED8;&#x8BA4;&#x503C;: true)</li></ul></li></ul><h3 id="t314.1 /home&#x7ED3;&#x675F;">4.1 /home&#x7ED3;&#x675F; <a href="#t314.1 /home&#x7ED3;&#x675F;">#</a></h3><pre><code class="lang-js"><span class="hljs-keyword">let</span> pathToRegExp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;path-to-regexp&apos;</span>);
<span class="hljs-keyword">let</span> regxp = pathToRegExp(<span class="hljs-string">&apos;/home&apos;</span>,[],{<span class="hljs-attr">end</span>:<span class="hljs-literal">true</span>});
<span class="hljs-built_in">console</span>.log(regxp);<span class="hljs-comment">//   /^\/home\/?$/i</span>
<span class="hljs-built_in">console</span>.log(regxp.test(<span class="hljs-string">&apos;/home&apos;</span>));
<span class="hljs-built_in">console</span>.log(regxp.test(<span class="hljs-string">&apos;/home/2&apos;</span>));
</code></pre><p><img src="../static/zhufengImg/homereg.png" alt="homereg"></p><h3 id="t324.2 /home&#x975E;&#x7ED3;&#x675F;">4.2 /home&#x975E;&#x7ED3;&#x675F; <a href="#t324.2 /home&#x975E;&#x7ED3;&#x675F;">#</a></h3><pre><code class="lang-js"><span class="hljs-keyword">let</span> pathToRegExp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;path-to-regexp&apos;</span>);
<span class="hljs-keyword">let</span> regExp = pathToRegExp(<span class="hljs-string">&apos;/home&apos;</span>,[],{<span class="hljs-attr">end</span>:<span class="hljs-literal">false</span>});
<span class="hljs-built_in">console</span>.log(regExp);<span class="hljs-comment">//   /^\/home\/?(?=\/|$)/i</span>
<span class="hljs-built_in">console</span>.log(regExp.test(<span class="hljs-string">&apos;/home&apos;</span>));
<span class="hljs-built_in">console</span>.log(regExp.test(<span class="hljs-string">&apos;/home/&apos;</span>));
<span class="hljs-built_in">console</span>.log(regExp.test(<span class="hljs-string">&apos;/home//&apos;</span>));
<span class="hljs-built_in">console</span>.log(regExp.test(<span class="hljs-string">&apos;/home/2&apos;</span>));
</code></pre><p><img src="../static/zhufengImg/homereg2.png" alt="homereg2"></p><h3 id="t334.3 &#x8DEF;&#x5F84;&#x53C2;&#x6570;">4.3 &#x8DEF;&#x5F84;&#x53C2;&#x6570; <a href="#t334.3 &#x8DEF;&#x5F84;&#x53C2;&#x6570;">#</a></h3><pre><code class="lang-js"><span class="hljs-keyword">let</span> params = [];
<span class="hljs-keyword">let</span> regExp = pathToRegExp(<span class="hljs-string">&apos;/user/:id&apos;</span>,params,{<span class="hljs-attr">end</span>:<span class="hljs-literal">true</span>});
<span class="hljs-built_in">console</span>.log(regExp,params);
<span class="hljs-comment">/**
/^\/user\/(?:([^\/]+?))\/?$/i
[ { name: &apos;id&apos;, optional: false, offset: 7 } ]
**/</span>
</code></pre><p><img src="../static/zhufengImg/uerreg.png" alt="uerreg"></p><h3 id="t344.4 &#x6B63;&#x5219;&#x5339;&#x914D;">4.4 &#x6B63;&#x5219;&#x5339;&#x914D; <a href="#t344.4 &#x6B63;&#x5219;&#x5339;&#x914D;">#</a></h3><ul><li>&#x662F;&#x5426;&#x6355;&#x83B7;</li></ul><table><thead><tr><th style="text-align:left">&#x8868;&#x8FBE;&#x5F0F;</th><th style="text-align:left">&#x542B;&#x4E49;</th></tr></thead><tbody><tr><td style="text-align:left">()</td><td style="text-align:left">&#x8868;&#x793A;&#x6355;&#x83B7;&#x5206;&#x7EC4;&#xFF0C;()&#x4F1A;&#x628A;&#x6BCF;&#x4E2A;&#x5206;&#x7EC4;&#x91CC;&#x7684;&#x5339;&#x914D;&#x7684;&#x503C;&#x4FDD;&#x5B58;&#x8D77;&#x6765;&#xFF0C;&#x4F7F;&#x7528;$n(n&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;&#x8868;&#x793A;&#x7B2C;n&#x4E2A;&#x6355;&#x83B7;&#x7EC4;&#x7684;&#x5185;&#x5BB9;)</td></tr><tr><td style="text-align:left">(?:)</td><td style="text-align:left">&#x8868;&#x793A;&#x975E;&#x6355;&#x83B7;&#x5206;&#x7EC4;&#xFF0C;&#x548C;&#x6355;&#x83B7;&#x5206;&#x7EC4;&#x552F;&#x4E00;&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#xFF0C;&#x975E;&#x6355;&#x83B7;&#x5206;&#x7EC4;&#x5339;&#x914D;&#x7684;&#x503C;&#x4E0D;&#x4F1A;&#x4FDD;&#x5B58;&#x8D77;&#x6765;</td></tr><tr><td style="text-align:left">(?<name>...)</name></td><td style="text-align:left">&#x8868;&#x793A;&#x547D;&#x540D;&#x6355;&#x83B7;&#x5206;&#x7EC4;,&#x53CD;&#x5411;&#x5F15;&#x7528;&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x5206;&#x7EC4;&#x7684;&#x8BED;&#x6CD5;&#x662F; \k<name>,&#x5728; replace() &#x65B9;&#x6CD5;&#x7684;&#x66FF;&#x6362;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x53CD;&#x5411;&#x5F15;&#x7528;&#x662F;&#x7528; $<name></name></name></td></tr></tbody></table><pre><code class="lang-js"><span class="hljs-comment">//&#x5206;&#x7EC4;&#x83B7;&#x53D6;</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;1ab&apos;</span>.match(<span class="hljs-regexp">/1[a-z]([b-c])/</span>));
<span class="hljs-comment">//&#x5206;&#x7EC4;&#x4E0D;&#x6355;&#x83B7;</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;1ab&apos;</span>.match(<span class="hljs-regexp">/1[a-z](?:[a-z])/</span>));
<span class="hljs-comment">//?&lt;x&gt; &#x8868;&#x793A;&#x547D;&#x540D;&#x6355;&#x83B7;&#x5206;&#x7EC4;</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-regexp">/(?&lt;x&gt;\d{2})-(?&lt;y&gt;\d{2})/</span>.exec(<span class="hljs-string">&apos;11-22&apos;</span>));
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;11-22&apos;</span>.replace(<span class="hljs-regexp">/(?&lt;x&gt;\d{2})-(?&lt;y&gt;\d{2})/</span>,<span class="hljs-string">&quot;$&lt;y&gt;-$&lt;x&gt;&quot;</span>));
</code></pre><ul><li>&#x524D;&#x77BB;&#x548C;&#x540E;&#x987E;</li></ul><table><thead><tr><th style="text-align:left">&#x8868;&#x8FBE;&#x5F0F;</th><th style="text-align:left">&#x542B;&#x4E49;</th></tr></thead><tbody><tr><td style="text-align:left">(?=pattern)</td><td style="text-align:left">&#x6B63;&#x5411;&#x80AF;&#x5B9A;&#x67E5;&#x627E;(&#x524D;&#x77BB;),&#x540E;&#x9762;&#x5FC5;&#x987B;&#x8DDF;&#x7740;&#x4EC0;&#x4E48;</td></tr><tr><td style="text-align:left">(?!pattern)</td><td style="text-align:left">&#x6B63;&#x5411;&#x5426;&#x5B9A;&#x67E5;&#x627E;(&#x524D;&#x77BB;)&#xFF0C;&#x540E;&#x9762;&#x4E0D;&#x80FD;&#x8DDF;&#x7740;&#x4EC0;&#x4E48;</td></tr><tr><td style="text-align:left">(?&lt;=pattern)</td><td style="text-align:left">&#x53CD;&#x5411;&#x80AF;&#x5B9A;&#x6761;&#x4EF6;&#x67E5;&#x627E;(&#x540E;&#x987E;),&#x4E0D;&#x6355;&#x83B7;</td></tr><tr><td style="text-align:left">(?&lt;!pattern)</td><td style="text-align:left">&#x53CD;&#x5411;&#x5426;&#x5B9A;&#x6761;&#x4EF6;&#x67E5;&#x627E;&#xFF08;&#x540E;&#x987E;&#xFF09;</td></tr></tbody></table><pre><code class="lang-js"><span class="hljs-comment">//&#x4F1A;&#x6D88;&#x8017;&#x6389;&#x5B57;&#x7B26;&#x7684;</span>
<span class="hljs-comment">//console.log(&apos;1a&apos;.match(/\d[a-z][a-z]/));</span>
<span class="hljs-comment">//?= &#x6B63;&#x5411;&#x80AF;&#x5B9A;&#x67E5;&#x627E; &#x4E0D;&#x6D88;&#x8D39;&#x5B57;&#x7B26; &#x6B63;&#x5411;&#x524D;&#x77BB;</span>
<span class="hljs-comment">//console.log(&apos;1a&apos;.match(/\d(?=[a-z])[a-z]/));</span>

<span class="hljs-comment">//&#x6B63;&#x5411;&#x80AF;&#x5B9A;&#x524D;&#x77BB;</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;1a&apos;</span>.match(<span class="hljs-regexp">/\d(?=[a-z])[a-z]/</span>));
<span class="hljs-comment">//&#x6B63;&#x5411;&#x5426;&#x5B9A;&#x524D;&#x77BB;</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;1a&apos;</span>.match(<span class="hljs-regexp">/\d(?![A-Z])[a-z]/</span>));
<span class="hljs-comment">//&#x53CD;&#x5411;&#x80AF;&#x5B9A;&#x524D;&#x77BB;</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;1a&apos;</span>.match(<span class="hljs-regexp">/(?&lt;=[a-z])\d[a-z]/</span>));
<span class="hljs-comment">//&#x53CD;&#x5411;&#x5426;&#x5B9A;&#x524D;&#x77BB;</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;1a&apos;</span>.match(<span class="hljs-regexp">/(?&lt;![A-Z])\d[a-z]/</span>));

<span class="hljs-keyword">let</span> array = [<span class="hljs-string">&apos;1ab&apos;</span>];
array.index = <span class="hljs-number">0</span>;
array.input = <span class="hljs-string">&apos;1ab&apos;</span>;
array.groups = <span class="hljs-literal">undefined</span>;
<span class="hljs-built_in">console</span>.log(array);
</code></pre><h2 id="t355. &#x6B63;&#x5219;&#x5339;&#x914D;">5. &#x6B63;&#x5219;&#x5339;&#x914D; <a href="#t355. &#x6B63;&#x5219;&#x5339;&#x914D;">#</a></h2><h3 id="t365.1 matchPath.js">5.1 matchPath.js <a href="#t365.1 matchPath.js">#</a></h3><p>src\react-router\matchPath.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> pathToRegexp <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;path-to-regexp&apos;</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compilePath</span>(<span class="hljs-params">path,options</span>)</span>{
    <span class="hljs-keyword">const</span> keys = [];
    <span class="hljs-keyword">const</span> regexp = pathToRegexp(path,keys,options);
    <span class="hljs-keyword">return</span> {keys,regexp};
}
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@param <span class="hljs-type">{*}</span> </span>pathname &#x6D4F;&#x89C8;&#x5668;&#x680F;&#x4E2D;&#x7684;&#x771F;&#x5B9E;&#x8DEF;&#x5F84;
 * <span class="hljs-doctag">@param <span class="hljs-type">{*}</span> </span>options &#x5339;&#x914D;&#x7684;&#x53C2;&#x6570; path exact strict sensitive
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">matchPath</span>(<span class="hljs-params">pathname,options = {}</span>)</span>{
    <span class="hljs-keyword">let</span> {path=<span class="hljs-string">&apos;/&apos;</span>,exact=<span class="hljs-literal">false</span>,strict=<span class="hljs-literal">false</span>,sensitive=<span class="hljs-literal">false</span>}=options;
    <span class="hljs-keyword">let</span> {keys,regexp} = compilePath(path,{
        <span class="hljs-attr">end</span>:exact,
        strict,
        sensitive
    }); <span class="hljs-comment">// /post/:id  keys=[&quot;id&quot;] regexp= /\/post\/([^\/]+?)/</span>
    <span class="hljs-keyword">const</span> match = regexp.exec(pathname);
    <span class="hljs-keyword">if</span>(!match) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> [url,...values] = match;<span class="hljs-comment">//[&apos;/post/1&apos;,&apos;1&apos;] url=/post/1 values=[&apos;1&apos;]</span>
    <span class="hljs-comment">// pathname /post/1/name !== /post/1</span>
    <span class="hljs-keyword">const</span> isExact = pathname === url;
    <span class="hljs-comment">//&#x9700;&#x8981;&#x7CBE;&#x786E;&#x5339;&#x914D;&#xFF0C;&#x4F46;&#x662F;&#x5339;&#x914D;&#x7684;&#x4E0D;&#x7CBE;&#x786E;&#xFF0C;&#x6CA1;&#x6709;&#x5B8C;&#x5168;&#x76F8;&#x7B49;&#xFF0C;&#x4E5F;&#x76F8;&#x5F53;&#x4E8E;&#x6CA1;&#x5339;&#x914D;&#x4E0A;</span>
    <span class="hljs-keyword">if</span>(exact &amp;&amp; !isExact) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> { <span class="hljs-comment">//&#x8DEF;&#x7531;&#x7EC4;&#x4EF6;&#x4E2D;props.match</span>
        path,<span class="hljs-comment">//Route&#x539F;&#x59CB;path</span>
        url,<span class="hljs-comment">//&#x6B63;&#x5219;&#x5339;&#x914D;&#x5230;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x7684;pathname&#x7684;&#x90E8;&#x5206;</span>
        isExact,
        <span class="hljs-attr">params</span>:keys.reduce(<span class="hljs-function">(<span class="hljs-params">memo,key,index</span>)=&gt;</span>{
            memo[key.name] = values[index];
            <span class="hljs-keyword">return</span> memo;
        },{})
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> matchPath;
</code></pre><h3 id="t375.2 Router.js">5.2 Router.js <a href="#t375.2 Router.js">#</a></h3><p>src\react-router\Router.js</p><pre><code class="lang-diff">import React from &apos;react&apos;
import RouterContext from &apos;./RouterContext&apos;;
class Router extends React.Component{
<span class="hljs-addition">+    static computeRootMatch(pathname) {</span>
<span class="hljs-addition">+        return { path: &quot;/&quot;, url: &quot;/&quot;, params: {}, isExact: pathname === &quot;/&quot; };</span>
<span class="hljs-addition">+    }</span>
    constructor(props){
        super(props);
        this.state = {
            location:props.history.location
        }
        //&#x5F53;&#x8DEF;&#x5F84;&#x53D1;&#x751F;&#x7684;&#x53D8;&#x5316;&#x7684;&#x65F6;&#x5019;&#x6267;&#x884C;&#x56DE;&#x8C03;
        this.unlisten = props.history.listen((location)=&gt;{
            this.setState({location});
        });
    }
    componentWillUnmount(){
        this.unlisten&amp;&amp;this.unlisten();
    }
    render(){
        let value = {//&#x901A;&#x8FC7;value&#x5411;&#x4E0B;&#x5C42;&#x4F20;&#x9012;&#x6570;&#x636E;
            location:this.state.location,
            history:this.props.history,
<span class="hljs-addition">+            match: Router.computeRootMatch(this.state.location.pathname)</span>
        }
        return (
            &lt;RouterContext.Provider value={value}&gt;
                {this.props.children}
            &lt;/RouterContext.Provider&gt;
        )
    }
}

export default Router;
</code></pre><h3 id="t385.3 Route.js">5.3 Route.js <a href="#t385.3 Route.js">#</a></h3><p>src\react-router\Route.js</p><pre><code class="lang-diff">import React from &apos;react&apos;
import RouterContext from &apos;./RouterContext&apos;;
<span class="hljs-addition">+import matchPath from &apos;./matchPath&apos;;</span>
class Route extends React.Component{
    static contextType = RouterContext
    render(){
        const {history,location} = this.context;
        const {component:RouteComponent} = this.props;
<span class="hljs-addition">+        const match = matchPath(location.pathname, this.props);</span>
        let routeProps = {history,location};
        let element=null;
        if (match) {
<span class="hljs-addition">+           routeProps.match = match;</span>
            element = &lt;RouteComponent {...routeProps} /&gt;
        }
        return (
            &lt;RouterContext.Provider value={routeProps}&gt;
                {element}
            &lt;/RouterContext.Provider&gt;
        )
    }
}
export default Route;
</code></pre><h3 id="t395.4 react-router\index.js">5.4 react-router\index.js <a href="#t395.4 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-diff">export {default as Route} from &apos;./Route&apos;;
export {default as Router} from &apos;./Router&apos;;
export {default as __RouterContext} from &apos;./RouterContext&apos;;
<span class="hljs-addition">+export {default as matchPath} from &apos;./matchPath&apos;;</span>
</code></pre><h2 id="t406. &#x5B9E;&#x73B0;Switch">6. &#x5B9E;&#x73B0;Switch <a href="#t406. &#x5B9E;&#x73B0;Switch">#</a></h2><h3 id="t416.1 Switch.js">6.1 Switch.js <a href="#t416.1 Switch.js">#</a></h3><p>src\react-router\Switch.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>
<span class="hljs-keyword">import</span> RouterContext <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./RouterContext&apos;</span>;
<span class="hljs-keyword">import</span> matchPath <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./matchPath&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Switch</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    <span class="hljs-keyword">static</span> contextType = RouterContext
    render() {
        <span class="hljs-keyword">const</span> { location } = <span class="hljs-keyword">this</span>.context;
        <span class="hljs-keyword">let</span> element, match;
        React.Children.forEach(<span class="hljs-keyword">this</span>.props.children, child =&gt; {
            <span class="hljs-keyword">if</span> (!match &amp;&amp; React.isValidElement(child)) {
                element = child;
                match = matchPath(location.pathname, child.props);
            }
        });
        <span class="hljs-keyword">return</span> match ? React.cloneElement(element, {<span class="hljs-attr">computedMatch</span>: match }) : <span class="hljs-literal">null</span>
    }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Switch;
</code></pre><h3 id="t426.2 Route.js">6.2 Route.js <a href="#t426.2 Route.js">#</a></h3><p>src\react-router\Route.js</p><pre><code class="lang-diff">import React from &apos;react&apos;
import RouterContext from &apos;./RouterContext&apos;;
import matchPath from &apos;./matchPath&apos;;
class Route extends React.Component{
    static contextType = RouterContext
    render(){
        const {history,location} = this.context;
<span class="hljs-addition">+        const {component:RouteComponent,computedMatch} = this.props;</span>
<span class="hljs-addition">+        const match = computedMatch ? computedMatch : matchPath(location.pathname, this.props);</span>
        let routeProps = {history,location};
        let element=null;
        if (match) {
            routeProps.match = match;
            element = &lt;RouteComponent {...routeProps} /&gt;
        }
        return (
            &lt;RouterContext.Provider value={routeProps}&gt;
                {element}
            &lt;/RouterContext.Provider&gt;
        )
    }
}
export default Route;
</code></pre><h3 id="t436.3 react-router\index.js">6.3 react-router\index.js <a href="#t436.3 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-diff">export {default as Route} from &apos;./Route&apos;;
export {default as Router} from &apos;./Router&apos;;
export {default as __RouterContext} from &apos;./RouterContext&apos;;
export {default as matchPath} from &apos;./matchPath&apos;;
<span class="hljs-addition">+export {default as Switch} from &apos;./Switch&apos;;</span>
</code></pre><h3 id="t446.4 src\index.js">6.4 src\index.js <a href="#t446.4 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {HashRouter as Router,Route,Switch} from &apos;./react-router-dom&apos;;
import Home from &apos;./components/Home&apos;;
import User from &apos;./components/User&apos;;
import Profile from &apos;./components/Profile&apos;;
ReactDOM.render(
    &lt;Router&gt;
<span class="hljs-addition">+        &lt;Switch&gt;</span>
          &lt;Route path=&quot;/&quot; component={Home} exact/&gt;
          &lt;Route path=&quot;/user&quot; component={User} /&gt;
          &lt;Route path=&quot;/profile&quot; component={Profile}/&gt;
<span class="hljs-addition">+        &lt;/Switch&gt;</span>
    &lt;/Router&gt;
,document.getElementById(&apos;root&apos;));
</code></pre><h2 id="t457. Redirect">7. Redirect <a href="#t457. Redirect">#</a></h2><h3 id="t467.1 Redirect.js">7.1 Redirect.js <a href="#t467.1 Redirect.js">#</a></h3><p>src\react-router\Redirect.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>
<span class="hljs-keyword">import</span> RouterContext <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./RouterContext&apos;</span>;
<span class="hljs-keyword">import</span> Lifecycle <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./Lifecycle&apos;</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Redirect</span>(<span class="hljs-params">{to}</span>)</span>{
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RouterContext.Consumer</span>&gt;</span>
            {
                contextValue=&gt;{
                    const {history}= contextValue;
                    return (
                        <span class="hljs-tag">&lt;<span class="hljs-name">Lifecycle</span>
                           <span class="hljs-attr">onMount</span>=<span class="hljs-string">{()</span>=&gt;</span>history.push(to)}
                        /&gt;
                    );
                }
            }
        <span class="hljs-tag">&lt;/<span class="hljs-name">RouterContext.Consumer</span>&gt;</span></span>
    );
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Redirect;
</code></pre><h3 id="t477.2 Lifecycle.js">7.2 Lifecycle.js <a href="#t477.2 Lifecycle.js">#</a></h3><p>src\react-router\Lifecycle.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lifecycle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    componentDidMount(){
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.props.onMount)
            <span class="hljs-keyword">this</span>.props.onMount(<span class="hljs-keyword">this</span>);
    }
    componentWillUnmount(){
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.props.onUnmount)
            <span class="hljs-keyword">this</span>.props.onUnmount(<span class="hljs-keyword">this</span>);
    }
    render(){
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Lifecycle;
</code></pre><h3 id="t487.3 react-router\index.js">7.3 react-router\index.js <a href="#t487.3 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-diff">export {default as Route} from &apos;./Route&apos;;
export {default as Router} from &apos;./Router&apos;;
export {default as __RouterContext} from &apos;./RouterContext&apos;;
export {default as matchPath} from &apos;./matchPath&apos;;
export {default as Switch} from &apos;./Switch&apos;;
<span class="hljs-addition">+export {default as Redirect} from &apos;./Redirect&apos;;</span>
</code></pre><h3 id="t497.4 src\index.js">7.4 src\index.js <a href="#t497.4 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
<span class="hljs-addition">+import {HashRouter as Router,Route,Switch,Redirect} from &apos;./react-router-dom&apos;;</span>
import Home from &apos;./components/Home&apos;;
import User from &apos;./components/User&apos;;
import Profile from &apos;./components/Profile&apos;;
ReactDOM.render(
    &lt;Router&gt;
        &lt;Switch&gt;
          &lt;Route path=&quot;/&quot; component={Home} exact/&gt;
          &lt;Route path=&quot;/user&quot; component={User} /&gt;
          &lt;Route path=&quot;/profile&quot; component={Profile}/&gt;
<span class="hljs-addition">+         &lt;Redirect to=&quot;/&quot;/&gt;</span>
        &lt;/Switch&gt;
    &lt;/Router&gt;
,document.getElementById(&apos;root&apos;));
</code></pre><h2 id="t508.Link">8.Link <a href="#t508.Link">#</a></h2><h3 id="t518.1 Link.js">8.1 Link.js <a href="#t518.1 Link.js">#</a></h3><p>src\react-router-dom\Link.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> {__RouterContext <span class="hljs-keyword">as</span> RouterContext} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../react-router&apos;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Link</span>(<span class="hljs-params">props</span>)</span>{
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RouterContext.Consumer</span>&gt;</span>
            {
                contextValue=&gt;{
                    return (
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
                           {<span class="hljs-attr">...props</span>}
                           <span class="hljs-attr">onClick</span>=<span class="hljs-string">{(event)</span>=&gt;</span>{
                              event.preventDefault();
                              contextValue.history.push(props.to);
                           }}
                        &gt;{props.children}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    )
                }
            }
        <span class="hljs-tag">&lt;/<span class="hljs-name">RouterContext.Consumer</span>&gt;</span></span>
    )
}
</code></pre><h3 id="t528.2 react-router-dom\index.js">8.2 react-router-dom\index.js <a href="#t528.2 react-router-dom\index.js">#</a></h3><p>src\react-router-dom\index.js</p><pre><code class="lang-diff">export * from &apos;../react-router&apos;;
export {default as HashRouter} from &apos;./HashRouter&apos;;
export {default as BrowserRouter} from &apos;./BrowserRouter&apos;;
<span class="hljs-addition">+export {default as Link} from &apos;./Link&apos;;</span>
</code></pre><h3 id="t538.3 src\index.js">8.3 src\index.js <a href="#t538.3 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
<span class="hljs-addition">+import {HashRouter as Router,Route,Switch,Redirect,Link} from &apos;./react-router-dom&apos;;</span>
import Home from &apos;./components/Home&apos;;
import User from &apos;./components/User&apos;;
import Profile from &apos;./components/Profile&apos;;
ReactDOM.render(
    &lt;Router&gt;
<span class="hljs-addition">+      &lt;ul&gt;</span>
<span class="hljs-addition">+          &lt;li&gt;&lt;Link to=&quot;/&quot;&gt;&#x9996;&#x9875;&lt;/Link&gt;&lt;/li&gt;</span>
<span class="hljs-addition">+          &lt;li&gt;&lt;Link to=&quot;/user&quot; &gt;&#x7528;&#x6237;&#x7BA1;&#x7406;&lt;/Link&gt;&lt;/li&gt;</span>
<span class="hljs-addition">+          &lt;li&gt;&lt;Link to=&quot;/profile&quot; &gt;&#x4E2A;&#x4EBA;&#x4E2D;&#x5FC3;&lt;/Link&gt;&lt;/li&gt;</span>
<span class="hljs-addition">+      &lt;/ul&gt;</span>
        &lt;Switch&gt;
          &lt;Route path=&quot;/&quot; component={Home} exact/&gt;
          &lt;Route path=&quot;/user&quot; component={User} /&gt;
          &lt;Route path=&quot;/profile&quot; component={Profile}/&gt;
          &lt;Redirect to=&quot;/&quot;/&gt;
        &lt;/Switch&gt;
    &lt;/Router&gt;
,document.getElementById(&apos;root&apos;));
</code></pre><h2 id="t549.&#x5D4C;&#x5957;&#x8DEF;&#x7531;">9.&#x5D4C;&#x5957;&#x8DEF;&#x7531; <a href="#t549.&#x5D4C;&#x5957;&#x8DEF;&#x7531;">#</a></h2><h3 id="t559.1 utils.js">9.1 utils.js <a href="#t559.1 utils.js">#</a></h3><p>src\utils.js</p><pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> UserAPI = {
    list(){
        <span class="hljs-keyword">let</span> usersStr = localStorage.getItem(<span class="hljs-string">&apos;users&apos;</span>);
        <span class="hljs-keyword">let</span> users= usersStr ? <span class="hljs-built_in">JSON</span>.parse(usersStr) : [];
        <span class="hljs-keyword">return</span> users;
    },
    add(user){
        <span class="hljs-keyword">let</span> users = UserAPI.list();
        users.push(user);
        localStorage.setItem(<span class="hljs-string">&apos;users&apos;</span>, <span class="hljs-built_in">JSON</span>.stringify(users));
    },
    find(id){
        <span class="hljs-keyword">let</span> users = UserAPI.list();
        <span class="hljs-keyword">return</span> users.find(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> user.id === id);
    }
}
</code></pre><h3 id="t569.2 User.js">9.2 User.js <a href="#t569.2 User.js">#</a></h3><p>src\components\User.js</p><pre><code class="lang-diff">import React from &apos;react&apos;;
import { Link, Route } from &apos;../react-router-dom&apos;;
<span class="hljs-addition">+import UserAdd from &apos;./UserAdd&apos;;</span>
<span class="hljs-addition">+import UserDetail from &apos;./UserDetail&apos;;</span>
<span class="hljs-addition">+import UserList from &apos;./UserList&apos;;</span>
export default function User() {
    return (
<span class="hljs-addition">+        &lt;div&gt;</span>
<span class="hljs-addition">+             &lt;ul&gt;</span>
<span class="hljs-addition">+                    &lt;li&gt;&lt;Link to=&quot;/user/list&quot;&gt;&#x7528;&#x6237;&#x5217;&#x8868;&lt;/Link&gt;&lt;/li&gt;</span>
<span class="hljs-addition">+                    &lt;li&gt;&lt;Link to=&quot;/user/add&quot;&gt;&#x6DFB;&#x52A0;&#x7528;&#x6237;&lt;/Link&gt;&lt;/li&gt;</span>
<span class="hljs-addition">+                &lt;/ul&gt;</span>
<span class="hljs-addition">+            &lt;div&gt;</span>
<span class="hljs-addition">+                &lt;Route path=&quot;/user/add&quot; component={UserAdd} /&gt;</span>
<span class="hljs-addition">+                &lt;Route path=&quot;/user/list&quot; component={UserList} /&gt;</span>
<span class="hljs-addition">+                &lt;Route path=&quot;/user/detail/:id&quot; component={UserDetail} /&gt;</span>
<span class="hljs-addition">+            &lt;/div&gt;</span>
<span class="hljs-addition">+        &lt;/div&gt;</span>
    )
}
</code></pre><h3 id="t579.3 UserAdd.js">9.3 UserAdd.js <a href="#t579.3 UserAdd.js">#</a></h3><p>src\components\UserAdd.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> {UserAPI} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../utils&apos;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserAdd</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    usernameRef
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.usernameRef = React.createRef();
    }
    handleSubmit = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        event.preventDefault();
        <span class="hljs-keyword">let</span> username = <span class="hljs-keyword">this</span>.usernameRef.current.value;
        UserAPI.add({ <span class="hljs-attr">id</span>: <span class="hljs-built_in">Date</span>.now() + <span class="hljs-string">&apos;&apos;</span>, username });
        <span class="hljs-keyword">this</span>.props.history.push(<span class="hljs-string">&apos;/user/list&apos;</span>);
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{this.handleSubmit}</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.usernameRef}</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> &gt;</span>&#x63D0;&#x4EA4;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
        )
    }
}
</code></pre><h3 id="t589.4 UserList.js">9.4 UserList.js <a href="#t589.4 UserList.js">#</a></h3><p>src\components\UserList.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>
<span class="hljs-keyword">import</span> { Link } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../react-router-dom&apos;</span>;
<span class="hljs-keyword">import</span> {UserAPI} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../utils&apos;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    state = { <span class="hljs-attr">users</span>: [] }
    componentDidMount() {
        <span class="hljs-keyword">let</span> users = UserAPI.list();
        <span class="hljs-keyword">this</span>.setState({ users });
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> &gt;</span>
                {
                    this.state.users.map((user, index) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>  <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">pathname:</span> `/<span class="hljs-attr">user</span>/<span class="hljs-attr">detail</span>/${<span class="hljs-attr">user.id</span>}`, <span class="hljs-attr">state:</span> <span class="hljs-attr">user</span> }}&gt;</span>{user.username}<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    ))
                }
            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
        )
    }
}
</code></pre><h3 id="t599.5 UserDetail.js">9.5 UserDetail.js <a href="#t599.5 UserDetail.js">#</a></h3><p>src\components\UserDetail.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> {UserAPI} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../utils&apos;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDetail</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    state = {
        <span class="hljs-attr">user</span>: {}
    }
    componentDidMount() {
        <span class="hljs-keyword">let</span> user = <span class="hljs-keyword">this</span>.props.location.state;
        <span class="hljs-keyword">if</span> (!user) {
            <span class="hljs-keyword">let</span> id = <span class="hljs-keyword">this</span>.props.match.params.id;
            user = UserAPI.find(id);
        }
        <span class="hljs-keyword">if</span> (user) <span class="hljs-keyword">this</span>.setState({ user });
    }
    render() {
        <span class="hljs-keyword">let</span> user = <span class="hljs-keyword">this</span>.state.user;
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                {user.id}:{user.username}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}
</code></pre><h2 id="t6010.&#x53D7;&#x4FDD;&#x62A4;&#x8DEF;&#x7531;">10.&#x53D7;&#x4FDD;&#x62A4;&#x8DEF;&#x7531; <a href="#t6010.&#x53D7;&#x4FDD;&#x62A4;&#x8DEF;&#x7531;">#</a></h2><h3 id="t6110.1 src\index.js">10.1 src\index.js <a href="#t6110.1 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
<span class="hljs-addition">+import {HashRouter as Router,Route,Switch,Redirect,Link} from &apos;./react-router-dom&apos;;</span>
import Home from &apos;./components/Home&apos;;
import User from &apos;./components/User&apos;;
import Profile from &apos;./components/Profile&apos;;
<span class="hljs-addition">+import Protected from &apos;./components/Protected&apos;;</span>
<span class="hljs-addition">+import Login from &apos;./components/Login&apos;;</span>
ReactDOM.render(
    &lt;Router&gt;
      &lt;ul&gt;
          &lt;li&gt;&lt;Link to=&quot;/&quot;&gt;&#x9996;&#x9875;&lt;/Link&gt;&lt;/li&gt;
          &lt;li&gt;&lt;Link to=&quot;/user&quot; &gt;&#x7528;&#x6237;&#x7BA1;&#x7406;&lt;/Link&gt;&lt;/li&gt;
          &lt;li&gt;&lt;Link to=&quot;/profile&quot; &gt;&#x4E2A;&#x4EBA;&#x4E2D;&#x5FC3;&lt;/Link&gt;&lt;/li&gt;
      &lt;/ul&gt;
        &lt;Switch&gt;
          &lt;Route path=&quot;/&quot; component={Home} exact/&gt;
          &lt;Route path=&quot;/user&quot; component={User} /&gt;
<span class="hljs-addition">+         &lt;Protected path=&quot;/profile&quot; component={Profile}/&gt;</span>
<span class="hljs-addition">+         &lt;Route path=&quot;/login&quot; component={Login}/&gt;</span>
          &lt;Redirect to=&quot;/&quot;/&gt;
        &lt;/Switch&gt;
    &lt;/Router&gt;
,document.getElementById(&apos;root&apos;));
</code></pre><h3 id="t6210.2 Route.js">10.2 Route.js <a href="#t6210.2 Route.js">#</a></h3><p>src\react-router\Route.js</p><pre><code class="lang-diff">import React from &apos;react&apos;
import RouterContext from &apos;./RouterContext&apos;;
import matchPath from &apos;./matchPath&apos;;
class Route extends React.Component{
    static contextType = RouterContext
    render(){
        const {history,location} = this.context;
<span class="hljs-addition">+       const {component:RouteComponent,computedMatch,render} = this.props;</span>
        const match = computedMatch ? computedMatch : matchPath(location.pathname, this.props);
        let routeProps = {history,location};
        let element=null;
<span class="hljs-addition">+       if (match) {</span>
<span class="hljs-addition">+           routeProps.match = match;</span>
<span class="hljs-addition">+           if (RouteComponent) {</span>
<span class="hljs-addition">+               element = &lt;RouteComponent {...routeProps} /&gt;</span>
<span class="hljs-addition">+           } else if (render) {</span>
<span class="hljs-addition">+               element=  render(routeProps);</span>
<span class="hljs-addition">+           } else {</span>
<span class="hljs-addition">+               element=  null;</span>
<span class="hljs-addition">+           }</span>
<span class="hljs-addition">+       }else {</span>
<span class="hljs-addition">+            element=  null;</span>
<span class="hljs-addition">+       }</span>
        return (
            &lt;RouterContext.Provider value={routeProps}&gt;
                {element}
            &lt;/RouterContext.Provider&gt;
        )
    }
}
export default Route;
</code></pre><h3 id="t6310.3 Login.js">10.3 Login.js <a href="#t6310.3 Login.js">#</a></h3><p>src\components\Login.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Login</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    login = <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
        localStorage.setItem(<span class="hljs-string">&apos;login&apos;</span>,<span class="hljs-string">&apos;true&apos;</span>);
        <span class="hljs-keyword">let</span> to=<span class="hljs-string">&apos;/&apos;</span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.props.location.state){
            to=<span class="hljs-keyword">this</span>.props.location.state.from||<span class="hljs-string">&apos;/&apos;</span>;
        }
        <span class="hljs-keyword">this</span>.props.history.push(to);
    }
    render(){
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.login}</span>&gt;</span>&#x767B;&#x5F55;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
        )
    }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Login;
</code></pre><h3 id="t6410.4 Protected.js">10.4 Protected.js <a href="#t6410.4 Protected.js">#</a></h3><p>src\components\Protected.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> {Route,Redirect} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../react-router-dom&apos;</span>;
<span class="hljs-keyword">const</span> Protected =  <span class="hljs-function">(<span class="hljs-params">props</span>)=&gt;</span>{
    <span class="hljs-keyword">let</span> {<span class="hljs-attr">component</span>:RouteComponent,path} = props;
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">{path}</span> <span class="hljs-attr">render</span>=<span class="hljs-string">{</span>
            (<span class="hljs-attr">routeProps</span>)=&gt;</span>(
                localStorage.getItem(&apos;login&apos;)?<span class="hljs-tag">&lt;<span class="hljs-name">RouteComponent</span> {<span class="hljs-attr">...routeProps</span>}/&gt;</span>:
                <span class="hljs-tag">&lt;<span class="hljs-name">Redirect</span> <span class="hljs-attr">to</span>=<span class="hljs-string">{{pathname:</span>&apos;/<span class="hljs-attr">login</span>&apos;,<span class="hljs-attr">state:</span>{<span class="hljs-attr">from:path</span>}}}/&gt;</span>
            )
        }/&gt;</span>
    )
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Protected;
</code></pre><h2 id="t6511.NavLink">11.NavLink <a href="#t6511.NavLink">#</a></h2><h3 id="t6611.1 public\index.html">11.1 public\index.html <a href="#t6611.1 public\index.html">#</a></h3><p>public\index.html</p><pre><code class="lang-diff">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;
    &lt;meta name=&quot;theme-color&quot; content=&quot;#000000&quot; /&gt;
    &lt;meta
      name=&quot;description&quot;
      content=&quot;Web site created using create-react-app&quot;
    /&gt;
    &lt;title&gt;React App&lt;/title&gt;
    &lt;style&gt;
<span class="hljs-addition">+      .strong{</span>
<span class="hljs-addition">+        font-size: 20px;</span>
<span class="hljs-addition">+      }</span>
<span class="hljs-addition">+      .active{</span>
<span class="hljs-addition">+        background-color: green;</span>
<span class="hljs-addition">+      }</span>
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="t6711.2 src\index.js">11.2 src\index.js <a href="#t6711.2 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
<span class="hljs-addition">+import {HashRouter as Router,Route,Switch,Redirect,NavLink} from &apos;./react-router-dom&apos;;</span>
import Home from &apos;./components/Home&apos;;
import User from &apos;./components/User&apos;;
import Profile from &apos;./components/Profile&apos;;
import Protected from &apos;./components/Protected&apos;;
import Login from &apos;./components/Login&apos;;
ReactDOM.render(
    &lt;Router&gt;
      &lt;ul&gt;
<span class="hljs-addition">+        &lt;li&gt;&lt;NavLink className=&quot;strong&quot; style={{textDecoration: &apos;line-through&apos;}} activeStyle={{color:&apos;red&apos;}} to=&quot;/&quot; exact&gt;Home&lt;/NavLink&gt;&lt;/li&gt;</span>
<span class="hljs-addition">+        &lt;li&gt;&lt;NavLink activeStyle={{color:&apos;red&apos;}}  to=&quot;/user&quot;&gt;User&lt;/NavLink&gt;&lt;/li&gt;</span>
<span class="hljs-addition">+        &lt;li&gt;&lt;NavLink activeStyle={{color:&apos;red&apos;}}  to=&quot;/profile&quot;&gt;Profile&lt;/NavLink&gt;&lt;/li&gt;</span>
      &lt;/ul&gt;
        &lt;Switch&gt;
          &lt;Route path=&quot;/&quot; component={Home} exact/&gt;
          &lt;Route path=&quot;/user&quot; component={User} /&gt;
          &lt;Protected path=&quot;/profile&quot; component={Profile}/&gt;
          &lt;Route path=&quot;/login&quot; component={Login}/&gt;
          &lt;Redirect to=&quot;/&quot;/&gt;
        &lt;/Switch&gt;
    &lt;/Router&gt;
,document.getElementById(&apos;root&apos;));
</code></pre><h3 id="t6811.3 NavLink.js">11.3 NavLink.js <a href="#t6811.3 NavLink.js">#</a></h3><p>src\react-router-dom\NavLink.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> {Route} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../react-router&apos;</span>;
<span class="hljs-keyword">import</span> matchPath <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../react-router/matchPath&apos;</span>;
<span class="hljs-keyword">import</span> Link <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./Link&apos;</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">NavLink</span>(<span class="hljs-params">props</span>)</span>{
    <span class="hljs-keyword">const</span> {
        <span class="hljs-attr">to</span>:path,<span class="hljs-comment">//Link&#x6307;&#x5411;&#x7684;&#x8DEF;&#x5F84;</span>
        <span class="hljs-attr">className</span>:classNameProp=<span class="hljs-string">&apos;&apos;</span>,<span class="hljs-comment">//&#x57FA;&#x672C;&#x7684;&#x7C7B;&#x540D;</span>
        <span class="hljs-attr">style</span>:styleProp={},<span class="hljs-comment">//&#x57FA;&#x672C;&#x7684;&#x884C;&#x5185;&#x6837;&#x5F0F;</span>
        activeClassName=<span class="hljs-string">&apos;active&apos;</span>,<span class="hljs-comment">//&#x6FC0;&#x6D3B;&#x7684;&#x7C7B;&#x540D;</span>
        activeStyle={},<span class="hljs-comment">//&#x6FC0;&#x6D3B;&#x7684;&#x884C;&#x5185;&#x6837;&#x5F0F;</span>
        children,<span class="hljs-comment">//&#x513F;&#x5B50;</span>
        exact<span class="hljs-comment">//&#x662F;&#x5426;&#x8981;&#x7CBE;&#x786E;&#x5339;&#x914D;</span>
    }= props;
     <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">{path}</span> <span class="hljs-attr">exact</span>=<span class="hljs-string">{exact}</span>&gt;</span>
            {
                ({match})=&gt;{
                    let className = match?joinClassNames(classNameProp,activeClassName):classNameProp;
                    let style =match?{...styleProp,...activeStyle}:styleProp;
                    let linkProps = {
                        className,
                        style,
                        to:path,
                        children
                    }
                    return <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> {<span class="hljs-attr">...linkProps</span>}/&gt;</span>
                }
            }
        <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span>
     )   
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">NavLink</span>(<span class="hljs-params">props</span>)</span>{
    <span class="hljs-keyword">let</span> context = React.useContext(RouterContext);
    <span class="hljs-keyword">let</span> {<span class="hljs-attr">location</span>:{pathname}}= context;
    <span class="hljs-keyword">const</span> {
        <span class="hljs-attr">to</span>:path,<span class="hljs-comment">//Link&#x6307;&#x5411;&#x7684;&#x8DEF;&#x5F84;</span>
        <span class="hljs-attr">className</span>:classNameProp=<span class="hljs-string">&apos;&apos;</span>,<span class="hljs-comment">//&#x57FA;&#x672C;&#x7684;&#x7C7B;&#x540D;</span>
        <span class="hljs-attr">style</span>:styleProp={},<span class="hljs-comment">//&#x57FA;&#x672C;&#x7684;&#x884C;&#x5185;&#x6837;&#x5F0F;</span>
        activeClassName=<span class="hljs-string">&apos;active&apos;</span>,<span class="hljs-comment">//&#x6FC0;&#x6D3B;&#x7684;&#x7C7B;&#x540D;</span>
        activeStyle={},<span class="hljs-comment">//&#x6FC0;&#x6D3B;&#x7684;&#x884C;&#x5185;&#x6837;&#x5F0F;</span>
        children,<span class="hljs-comment">//&#x513F;&#x5B50;</span>
        exact<span class="hljs-comment">//&#x662F;&#x5426;&#x8981;&#x7CBE;&#x786E;&#x5339;&#x914D;</span>
    }= props;
    <span class="hljs-comment">//pathname&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x8DEF;&#x5F84; path&#x6765;&#x81EA;&#x4E8E;NavLink&#x7684;&#x914D;&#x7F6E;</span>
    <span class="hljs-keyword">let</span> isActive = matchPath(pathname,{path,exact});
    <span class="hljs-keyword">let</span> className = isActive?joinClassNames(classNameProp,activeClassName):classNameProp;
    <span class="hljs-keyword">let</span> style = isActive?{...styleProp,...activeStyle}:styleProp;
    <span class="hljs-keyword">let</span> linkProps = {
        className,
        style,
        <span class="hljs-attr">to</span>:path,
        children
    }
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> {<span class="hljs-attr">...linkProps</span>}/&gt;</span></span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">joinClassNames</span>(<span class="hljs-params">...classnames</span>)</span>{
  <span class="hljs-keyword">return</span> classnames.filter(<span class="hljs-function"><span class="hljs-params">c</span>=&gt;</span>c).join(<span class="hljs-string">&apos; &apos;</span>);
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> NavLink;
</code></pre><h3 id="t6911.4 react-router-dom\index.js">11.4 react-router-dom\index.js <a href="#t6911.4 react-router-dom\index.js">#</a></h3><p>src\react-router-dom\index.js</p><pre><code class="lang-diff">export * from &apos;../react-router&apos;;
export {default as HashRouter} from &apos;./HashRouter&apos;;
export {default as BrowserRouter} from &apos;./BrowserRouter&apos;;
export {default as Link} from &apos;./Link&apos;;
<span class="hljs-addition">+export { default as NavLink } from &quot;./NavLink&quot;;</span>
</code></pre><h2 id="t7012.withRouter">12.withRouter <a href="#t7012.withRouter">#</a></h2><h3 id="t7112.1 src\index.js">12.1 src\index.js <a href="#t7112.1 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {HashRouter as Router,Route,Switch,Redirect,NavLink} from &apos;./react-router-dom&apos;;
import Home from &apos;./components/Home&apos;;
import User from &apos;./components/User&apos;;
import Profile from &apos;./components/Profile&apos;;
import Protected from &apos;./components/Protected&apos;;
import Login from &apos;./components/Login&apos;;
<span class="hljs-addition">+import NavHeader from &apos;./components/NavHeader&apos;;</span>
ReactDOM.render(
    &lt;Router&gt;
      &lt;&gt;
<span class="hljs-addition">+      &lt;NavHeader title=&quot;&#x6B22;&#x8FCE;&#x5149;&#x4E34;&quot;/&gt;</span>
      &lt;ul&gt;
        &lt;li&gt;&lt;NavLink className=&quot;strong&quot; style={{textDecoration: &apos;line-through&apos;}} activeStyle={{color:&apos;red&apos;}} to=&quot;/&quot; exact&gt;Home&lt;/NavLink&gt;&lt;/li&gt;
        &lt;li&gt;&lt;NavLink activeStyle={{color:&apos;red&apos;}}  to=&quot;/user&quot;&gt;User&lt;/NavLink&gt;&lt;/li&gt;
        &lt;li&gt;&lt;NavLink activeStyle={{color:&apos;red&apos;}}  to=&quot;/profile&quot;&gt;Profile&lt;/NavLink&gt;&lt;/li&gt;
      &lt;/ul&gt;
      &lt;Switch&gt;
          &lt;Route path=&quot;/&quot; component={Home} exact/&gt;
          &lt;Route path=&quot;/user&quot; component={User} /&gt;
          &lt;Protected path=&quot;/profile&quot; component={Profile}/&gt;
          &lt;Route path=&quot;/login&quot; component={Login}/&gt;
          &lt;Redirect to=&quot;/&quot;/&gt;
      &lt;/Switch&gt;
      &lt;/&gt;
    &lt;/Router&gt;
,document.getElementById(&apos;root&apos;));
</code></pre><h3 id="t7212.2 NavHeader.js">12.2 NavHeader.js <a href="#t7212.2 NavHeader.js">#</a></h3><p>src\components\NavHeader.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> {withRouter} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../react-router-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NavHeader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    render(){
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span>=&gt;</span>this.props.history.push(&apos;/&apos;)} &gt;{this.props.title}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> withRouter(NavHeader);
</code></pre><h3 id="t7312.3 withRouter.js">12.3 withRouter.js <a href="#t7312.3 withRouter.js">#</a></h3><p>src\react-router\withRouter.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> RouterContext <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./RouterContext&apos;</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">withRouter</span>(<span class="hljs-params">OldComponent</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">props</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RouterContext.Consumer</span>&gt;</span>
                {
                    contextValue =&gt;{
                        return <span class="hljs-tag">&lt;<span class="hljs-name">OldComponent</span> {<span class="hljs-attr">...props</span>} {<span class="hljs-attr">...contextValue</span>}/&gt;</span>
                    }
                }
            <span class="hljs-tag">&lt;/<span class="hljs-name">RouterContext.Consumer</span>&gt;</span></span>
        )
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> withRouter;
</code></pre><h3 id="t7412.4 react-router\index.js">12.4 react-router\index.js <a href="#t7412.4 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-diff">export {default as Route} from &apos;./Route&apos;;
export {default as Router} from &apos;./Router&apos;;
export {default as __RouterContext} from &apos;./RouterContext&apos;;
export {default as matchPath} from &apos;./matchPath&apos;;
export {default as Switch} from &apos;./Switch&apos;;
export {default as Redirect} from &apos;./Redirect&apos;;
<span class="hljs-addition">+export {default as withRouter} from &apos;./withRouter&apos;;</span>
</code></pre><h2 id="t7513.Prompt">13.Prompt <a href="#t7513.Prompt">#</a></h2><h3 id="t7613.1 src\index.js">13.1 src\index.js <a href="#t7613.1 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-diff">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
<span class="hljs-addition">+import {BrowserRouter as Router,Route,Switch,Redirect,NavLink} from &apos;./react-router-dom&apos;;</span>
import Home from &apos;./components/Home&apos;;
import User from &apos;./components/User&apos;;
import Profile from &apos;./components/Profile&apos;;
import Protected from &apos;./components/Protected&apos;;
import Login from &apos;./components/Login&apos;;
import NavHeader from &apos;./components/NavHeader&apos;;
ReactDOM.render(
<span class="hljs-addition">+    &lt;Router getUserConfirmation={()=&gt;window.confirm}&gt;</span>
      &lt;&gt;
      &lt;NavHeader title=&quot;&#x6B22;&#x8FCE;&#x5149;&#x4E34;&quot;/&gt;
      &lt;ul&gt;
        &lt;li&gt;&lt;NavLink className=&quot;strong&quot; style={{textDecoration: &apos;line-through&apos;}} activeStyle={{color:&apos;red&apos;}} to=&quot;/&quot; exact&gt;Home&lt;/NavLink&gt;&lt;/li&gt;
        &lt;li&gt;&lt;NavLink activeStyle={{color:&apos;red&apos;}}  to=&quot;/user&quot;&gt;User&lt;/NavLink&gt;&lt;/li&gt;
        &lt;li&gt;&lt;NavLink activeStyle={{color:&apos;red&apos;}}  to=&quot;/profile&quot;&gt;Profile&lt;/NavLink&gt;&lt;/li&gt;
      &lt;/ul&gt;
      &lt;Switch&gt;
          &lt;Route path=&quot;/&quot; component={Home} exact/&gt;
          &lt;Route path=&quot;/user&quot; component={User} /&gt;
          &lt;Protected path=&quot;/profile&quot; component={Profile}/&gt;
          &lt;Route path=&quot;/login&quot; component={Login}/&gt;
          &lt;Redirect to=&quot;/&quot;/&gt;
      &lt;/Switch&gt;
      &lt;/&gt;
    &lt;/Router&gt;
,document.getElementById(&apos;root&apos;));
</code></pre><h3 id="t7713.2 UserAdd.js">13.2 UserAdd.js <a href="#t7713.2 UserAdd.js">#</a></h3><p>src\components\UserAdd.js</p><pre><code class="lang-diff">import React, { Component } from &apos;react&apos;;
import {UserAPI} from &apos;../utils&apos;;
import {Prompt} from &apos;../react-router-dom&apos;;
export default class UserAdd extends Component {
    usernameRef
<span class="hljs-addition">+    state = {isBlocking:false}</span>
    constructor(props) {
        super(props);
        this.usernameRef = React.createRef();
    }
    handleSubmit = (event) =&gt; {
        event.preventDefault();
<span class="hljs-addition">+        this.setState({</span>
<span class="hljs-addition">+            isBlocking:false</span>
<span class="hljs-addition">+        },()=&gt;{</span>
            let username = this.usernameRef.current.value;
            UserAPI.add({ id: Date.now() + &apos;&apos;, username });
            this.props.history.push(&apos;/user/list&apos;);
<span class="hljs-addition">+        });</span>
    }
    render() {
        return (
            &lt;form onSubmit={this.handleSubmit}&gt;
<span class="hljs-addition">+                 &lt;Prompt</span>
<span class="hljs-addition">+                   when={this.state.isBlocking}</span>
<span class="hljs-addition">+                   message = {</span>
<span class="hljs-addition">+                       (location)=&gt;`&#x8BF7;&#x95EE;&#x4F60;&#x786E;&#x5B9A;&#x8981;&#x8DF3;&#x8F6C;&#x5230;${location.pathname}&#x5417;?`</span>
<span class="hljs-addition">+                   }</span>
<span class="hljs-addition">+                /&gt;</span>
<span class="hljs-addition">+               &lt;input  type=&quot;text&quot; ref={this.usernameRef}  onChange={(event) =&gt; {</span>
<span class="hljs-addition">+                   this.setState({ isBlocking: event.target.value.length &gt; 0 });</span>
<span class="hljs-addition">+               }} /&gt;</span>
                &lt;button type=&quot;submit&quot; &gt;&#x63D0;&#x4EA4;&lt;/button&gt;
            &lt;/form&gt;
        )
    }
}
</code></pre><h3 id="t7813.3 Prompt.js">13.3 Prompt.js <a href="#t7813.3 Prompt.js">#</a></h3><p>src\react-router\Prompt.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> RouterContext <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./RouterContext&apos;</span>;
<span class="hljs-keyword">import</span> LifeCycle <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./LifeCycle&apos;</span>;
<span class="hljs-comment">//&#x51FD;&#x6570;&#x7EC4;&#x4EF6;</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Prompt</span>(<span class="hljs-params">props</span>)</span>{
    <span class="hljs-keyword">let</span> value = React.useContext(RouterContext);
    React.useEffect(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
        <span class="hljs-keyword">return</span>  value.history.block(props.message)
    });
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
<span class="hljs-comment">//&#x7C7B;&#x7EC4;&#x4EF6;</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Prompt</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    <span class="hljs-keyword">static</span> contextType = RouterContext;
    componentDidMount(){
        <span class="hljs-keyword">const</span> block = <span class="hljs-keyword">this</span>.context.history.block;
        <span class="hljs-keyword">this</span>.release = block(<span class="hljs-keyword">this</span>.props.message)
    }
    componentWillUnmount(){
        <span class="hljs-keyword">this</span>.release()
    }
    render(){
        <span class="hljs-keyword">return</span>  <span class="hljs-literal">null</span>;
    }
}
<span class="hljs-comment">//&#x6E90;&#x7801;</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Prompt</span>(<span class="hljs-params">{when,message}</span>)</span>{
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RouterContext.Consumer</span>&gt;</span>
            {
                (value)=&gt;{
                    //&#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x963B;&#x6B62;&#x8DF3;&#x8F6C;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;null,&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x505A;
                    if(!when)return null;
                    //&#x9700;&#x8981;&#x7ED9;history&#x5BF9;&#x8C61;&#x4E0A;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;block&#x65B9;&#x6CD5;
                    const block = value.history.block;
                    return (
                        <span class="hljs-tag">&lt;<span class="hljs-name">LifeCycle</span>
                           <span class="hljs-attr">onMount</span>=<span class="hljs-string">{lifeCycleInstance</span>=&gt;</span>lifeCycleInstance.release = block(message)}
                           onUnMount={lifeCycleInstance=&gt;lifeCycleInstance.release()}
                        /&gt;
                    )

                }
            }
        <span class="hljs-tag">&lt;/<span class="hljs-name">RouterContext.Consumer</span>&gt;</span></span>
    )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Prompt;
</code></pre><h3 id="t7913.4 react-router\index.js">13.4 react-router\index.js <a href="#t7913.4 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-diff">export {default as Route} from &apos;./Route&apos;;
export {default as Router} from &apos;./Router&apos;;
export {default as __RouterContext} from &apos;./RouterContext&apos;;
export {default as matchPath} from &apos;./matchPath&apos;;
export {default as Switch} from &apos;./Switch&apos;;
export {default as Redirect} from &apos;./Redirect&apos;;
export {default as withRouter} from &apos;./withRouter&apos;;
<span class="hljs-addition">+export {default as Prompt} from &apos;./Prompt&apos;;</span>
</code></pre><h3 id="t8013.5 createBrowserHistory.js">13.5 createBrowserHistory.js <a href="#t8013.5 createBrowserHistory.js">#</a></h3><p>src\history\createBrowserHistory.js</p><pre><code class="lang-diff">
function createBrowserHistory(props){
<span class="hljs-addition">+   let confirm =props.getUserConfirmation?props.getUserConfirmation():window.confirm;</span>
    let globalHistory = window.history;
    let listeners = [];
<span class="hljs-addition">+   let message;</span>
    function go(n){
        globalHistory.go(n);
    }
    function goBack(){
        go(-1)
    }
    function goForward(){
        go(1)
    }
    function listen(listener){
        listeners.push(listener);
        return function(){//unlisten
            listeners = listeners.filter(l=&gt;l!==listener);
        }
    }
    function setState(newState){
        Object.assign(history,newState);
        history.length = globalHistory.length;
        listeners.forEach(listener=&gt;listener(history.location));
    }
    /**
     * @param {*} pathname &#x53EF;&#x80FD;&#x662F;&#x5BF9;&#x8C61;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x5B57;&#x7B26;&#x4E32;
     * @param {*} state &#x8FD9;&#x4E2A;&#x8DEF;&#x5F84;&#x7684;&#x72B6;&#x6001;&#x5BF9;&#x8C61;&#x662F;&#x4EC0;&#x4E48;,&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x8DEF;&#x5F84;&#x7684;&#x63CF;&#x8FF0;&#x4FE1;&#x606F;&#xFF0C;&#x53EF;&#x4EE5;&#x653E;&#x4EFB;&#x4F55;
     */
    function push(pathname, state){
        const action = &apos;PUSH&apos;;//&#x8868;&#x793A;&#x53D1;&#x4E86;&#x4EC0;&#x4E48;&#x52A8;&#x4F5C;&#x5F15;&#x8D77;&#x4E86;&#x8DEF;&#x5F84;&#x53D8;&#x5316; POP PUSH
        if(typeof pathname <span class="hljs-comment">=== &apos;object&apos;){</span>
            state=pathname.state;
            pathname= pathname.pathname;
        }
<span class="hljs-addition">+        if(message){</span>
<span class="hljs-addition">+            let showMessage = message({pathname});</span>
<span class="hljs-addition">+            let allow = confirm(showMessage);</span>
<span class="hljs-addition">+            if(!allow){</span>
<span class="hljs-addition">+                return;</span>
<span class="hljs-addition">+            }</span>
<span class="hljs-addition">+        }</span>
        globalHistory.pushState(state,null,pathname);
        let location = {state,pathname};
        setState({action,location});
    }
<span class="hljs-addition">+    function block(newMessage){</span>
<span class="hljs-addition">+        message=newMessage;</span>
<span class="hljs-addition">+        return ()=&gt; message=null;</span>
<span class="hljs-addition">+    }</span>
    const history = {
        action: &quot;POP&quot;,
        go,
        goBack,
        goForward,
        listen,
        location:{pathname:window.location.pathname,state:globalHistory.state},
        push,
<span class="hljs-addition">+        block</span>
    }
    return history;
}

export default createBrowserHistory;
</code></pre><h2 id="t8115.hooks">15.hooks <a href="#t8115.hooks">#</a></h2><h3 id="t8215.1 src\index.js">15.1 src\index.js <a href="#t8215.1 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-keyword">import</span> {BrowserRouter <span class="hljs-keyword">as</span> Router,Route,Link,
useParams,
useLocation,
useHistory,
useRouteMatch
} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react-router-dom&apos;</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Home</span>(<span class="hljs-params"></span>)</span>{
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#x9996;&#x9875;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">UserDetail</span>(<span class="hljs-params"></span>)</span>{
  <span class="hljs-keyword">let</span> params = useParams();
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;params&apos;</span>,params);
  <span class="hljs-keyword">let</span> location = useLocation();
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;location&apos;</span>,location);
  <span class="hljs-keyword">let</span> history = useHistory();
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;history&apos;</span>,history);
<span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>User id:{params.id} <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>name:{location.state.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Post</span>(<span class="hljs-params"></span>)</span>{
  <span class="hljs-keyword">let</span> match = useRouteMatch({
    <span class="hljs-attr">path</span>:<span class="hljs-string">&apos;/post/:id&apos;</span>,
    <span class="hljs-attr">strict</span>:<span class="hljs-literal">true</span>,
    <span class="hljs-attr">sensitive</span>:<span class="hljs-literal">true</span>
  });
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;match&apos;</span>,match);
  <span class="hljs-keyword">return</span> match?<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>id:{match.params.id}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>:<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Not Found<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
 ReactDOM.render(
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>&#x9996;&#x9875;<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Link</span>  <span class="hljs-attr">to</span>=<span class="hljs-string">{{pathname:</span>&quot;/<span class="hljs-attr">user</span>/<span class="hljs-attr">detail</span>/<span class="hljs-attr">1</span>&quot;,<span class="hljs-attr">state:</span>{<span class="hljs-attr">id:1</span>,<span class="hljs-attr">name:</span>&apos;&#x73E0;&#x5CF0;&#x67B6;&#x6784;&apos;}}}&gt;</span>&#x7528;&#x6237;1&#x8BE6;&#x60C5;<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/post/1&quot;</span>&gt;</span>&#x8D34;&#x5B50;<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Home}/</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/user/detail/:id&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{UserDetail}/</span>&gt;</span>   
    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/post/:id&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Post}/</span>&gt;</span>   
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>,
  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);

</code></pre><h3 id="t8315.2 hooks.js">15.2 hooks.js <a href="#t8315.2 hooks.js">#</a></h3><p>src\react-router\hooks.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> RouterContext <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./RouterContext&apos;</span>;
<span class="hljs-keyword">import</span> matchPath <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./matchPath&apos;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useParams</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">let</span> match = React.useContext(RouterContext).match;
    <span class="hljs-keyword">return</span> match?match.params:{};
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useLocation</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">return</span> React.useContext(RouterContext).location;
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useHistory</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">return</span> React.useContext(RouterContext).history;
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useRouteMatch</span>(<span class="hljs-params">path</span>)</span>{
   <span class="hljs-keyword">const</span> location = useLocation();<span class="hljs-comment">//&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7684;&#x8DEF;&#x5F84;pathname&#x4EE3;&#x8868;&#x5F53;&#x524D;&#x7684;&#x8DEF;&#x5F84;&#x540D;</span>
   <span class="hljs-keyword">let</span> match = React.useContext(RouterContext).match;<span class="hljs-comment">//&#x83B7;&#x5F97;&#x5339;&#x914D;&#x7ED3;&#x679C;</span>
   <span class="hljs-keyword">return</span> path?matchPath(location.pathname,path):match;
}
</code></pre><h3 id="t8415.3 react-router\index.js">15.3 react-router\index.js <a href="#t8415.3 react-router\index.js">#</a></h3><p>src\react-router\index.js</p><pre><code class="lang-diff">export {default as Route} from &apos;./Route&apos;;
export {default as Router} from &apos;./Router&apos;;
export {default as __RouterContext} from &apos;./RouterContext&apos;;
export {default as matchPath} from &apos;./matchPath&apos;;
export {default as Switch} from &apos;./Switch&apos;;
export {default as Redirect} from &apos;./Redirect&apos;;
export {default as withRouter} from &apos;./withRouter&apos;;
export {default as Prompt} from &apos;./Prompt&apos;;
<span class="hljs-addition">+export {useHistory,useLocation,useParams,useRouteMatch} from &apos;./hooks&apos;;</span>
</code></pre><h2 id="t8516.&#x8DEF;&#x7531;&#x61D2;&#x52A0;&#x8F7D;">16.&#x8DEF;&#x7531;&#x61D2;&#x52A0;&#x8F7D; <a href="#t8516.&#x8DEF;&#x7531;&#x61D2;&#x52A0;&#x8F7D;">#</a></h2><h3 id="t8616.1 src\index.js">16.1 src\index.js <a href="#t8616.1 src\index.js">#</a></h3><p>src\index.js</p><pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Suspense } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-keyword">import</span> {
  BrowserRouter <span class="hljs-keyword">as</span> Router, Route,Link
} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-router-dom&apos;</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lazy</span>(<span class="hljs-params">load</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    state = { <span class="hljs-attr">InnerComponent</span>: <span class="hljs-literal">null</span> }
    componentDidMount() {
      load().then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">InnerComponent</span>: result.default || result });
      });
    }
    render() {
      <span class="hljs-keyword">let</span> { InnerComponent } = <span class="hljs-keyword">this</span>.state;
      <span class="hljs-keyword">return</span> InnerComponent ? <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">InnerComponent</span> /&gt;</span></span> : <span class="hljs-literal">null</span>;
    }
  }
}
<span class="hljs-keyword">const</span> LazyHome = React.lazy(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: &quot;Home&quot; */</span><span class="hljs-string">&apos;./components/Home&apos;</span>));
<span class="hljs-keyword">const</span> LazyLogin = React.lazy(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: &quot;Login&quot; */</span><span class="hljs-string">&apos;./components/Login&apos;</span>));
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Loading</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#x52A0;&#x8F7D;&#x4E2D;......<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SuspenseHome</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Loading</span> /&gt;</span>}&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">LazyHome</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
  )
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SuspenseLogin</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Loading</span> /&gt;</span>}&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">LazyLogin</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
  )
}
<span class="hljs-comment">//webpack chunkFilename</span>
ReactDOM.render(
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/login&quot;</span>&gt;</span>User<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{SuspenseHome}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/login&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{SuspenseLogin}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>,
  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);

</code></pre><h2 id="t87&#x94FE;&#x63A5;">&#x94FE;&#x63A5; <a href="#t87&#x94FE;&#x63A5;">#</a></h2><ul><li><a href="https://gitee.com/zhufengpeixun/zhufeng_react_router_20201106_prepare">zhufeng_react_router</a></li></ul></div></div><div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="loginModalLabel">请登录</h4></div><div class="modal-body"><form><div class="form-group"><label for="username" class="control-label">姓名:</label> <input type="text" class="form-control" id="username" placeholder="珠峰架构VIP会员系统用户名"></div><div class="form-group"><label for="password" class="control-label">密码:</label> <input type="text" class="form-control" id="password" placeholder="珠峰架构VIP会员系统密码"></div></form></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">登录</button></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script><script>$(".warpper .page-toc ul ul li a").on("click",function(){$(".warpper .page-toc ul ul li a").removeClass("my-active"),$(this).addClass("my-active")}),$(".logo").on("mouseenter",function(){$(".nav").height("450px")}),$(".nav").on("mouseleave",function(){$(".nav").height("80px")}),$(".logo").on("click",function(){$(".nav").css("display","none"),$(".warpper").css("padding","0px")})</script><script type="text/javascript" src="../static/js/theme.js"></script></body></html>